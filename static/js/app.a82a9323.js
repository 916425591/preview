(function(){"use strict";var t={7447:function(t,e,n){var i=n(8935),o=n(3625),s=n.n(o),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},r=[],l=n(3736),c={},d=(0,l.Z)(c,a,r,!1,null,null,null),u=d.exports,p=n(2809),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("Header"),n("BusinessWrap"),n("Layer"),n("PanelContent"),n("THREE"),t.onLoad?n("Loading",{attrs:{loadingTime:t.time}}):t._e()],1)},h=[],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"core",style:{width:t.width+"px",height:t.height+"px"},attrs:{id:"div3d"}})},y=[],g={name:"ThreeLoad",props:{msg:String},data(){return{width:null,height:null}},methods:{init(){this.$nextTick((()=>{META.init()}))}},mounted(){this.width=this.$el.offsetWidth,this.height=this.$el.parentElement.offsetHeight,this.init()}},v=g,w=(0,l.Z)(v,f,y,!1,null,"7ffd81cb",null),x=w.exports,b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"loading"},[n("div",{staticClass:"gress"},[n("div",{staticClass:"sys-loading-name",staticStyle:{"justify-content":"center"}},[t._v(" 坪盐隧道 ")]),n("Progress",{attrs:{percent:t.loadingTime,"hide-info":""}}),n("div",{staticClass:"sys-loading-description",staticStyle:{"justify-content":"center"}},[n("span",{staticClass:"log"},[t._v("正在加载")]),t._v(t._s(t.loadingTime)+"% ")])],1)])},T=[],M={name:"LoadingPercent",props:{loadingTime:Number},data(){return{time:null}},methods:{},mounted(){}},E=M,S=(0,l.Z)(E,b,T,!1,null,"c1c0fb8e",null),P=S.exports,C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header"},[n("img",{attrs:{src:t.imgBg}})])},A=[],_={name:"HeaderTop",data(){return{imgBg:`${n(7027)}`}}},z=_,j=(0,l.Z)(z,C,A,!1,null,"e3c39b56",null),O=j.exports,I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"business",style:{top:t.top}},[n("img",{attrs:{src:t.imgBg}})])},k=[],L={name:"BusinessWrap",data(){return{top:window.innerWidth>1920?"28%":"36%",imgBg:`${n(5155)}`}}},$=L,F=(0,l.Z)($,I,k,!1,null,"3e19e3c2",null),D=F.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"panel",style:{top:t.top}},[n("img",{attrs:{src:t.imgBg}})])},R=[],N={name:"PanelContent",data(){return{top:window.innerWidth>1920?"21%":"30%",imgBg:`${n(9691)}`}}},W=N,H=(0,l.Z)(W,B,R,!1,null,"71bd5581",null),K=H.exports,Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"layer"},[n("img",{attrs:{src:t.imgBg}})])},G=[],Y={name:"LayerContent",data(){return{imgBg:`${n(9242)}`}}},U=Y,J=(0,l.Z)(U,Z,G,!1,null,"f0bf5b3a",null),X=J.exports,q={name:"HomeView",components:{THREE:x,Loading:P,Header:O,BusinessWrap:D,PanelContent:K,Layer:X},data(){return{time:0,interval:null,onLoad:!0}},methods:{load(){this.interval=setInterval((()=>{window.META.onLoad?(this.time=100,this.onLoad=!1,clearInterval(this.interval)):this.time>90?this.time=95:this.time+=5}),20)}},mounted(){this.load()}},V=q,Q=(0,l.Z)(V,m,h,!1,null,"2f1ddec6",null),tt=Q.exports;i["default"].use(p.Z);const et=[{path:"/",name:"home",component:tt},{path:"/about",name:"about",component:()=>n.e(443).then(n.bind(n,4613))}],nt=new p.Z({base:"",routes:et});var it=nt,ot=n(3226);const st=function(t,e){return toString.call(t)==="[object "+e+"]"},at=([t,e],[n,i])=>[(t+n)/2,(e+i)/2],rt=(t,e,n,i)=>{var o=Math.atan2(n-i,t-e);return 180/Math.PI*o},lt=(t,e,n,i)=>Math.sqrt((t-e)*(t-e)+(n-i)*(n-i)),ct=function(t,e){if(t){if(t.isVector3)return t;if(Array.isArray(t))return 1===t.length?new ot.Pa4(parseFloat(t[0]),0,0):2===t.length?new ot.Pa4(parseFloat(t[0]),0,parseFloat(t[1])):new ot.Pa4(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));if(st(t,"String")){for(var n=t.split(/,| /),i=0;i<n.length;i++){var o=n[i].trimBoth("\\[\\]");o.isBlank()?n.splice(i--,1):n[i]=Number(o)}return ct(n,e)}}return e},dt=new ot.Pa4,ut=new ot.ZzF;ot.Tme.prototype.selfToWorld=function(t,e=!0){if(t=ct(t),this.node.updateMatrixWorld(),e){const e=new ot.Pa4,i=new ot.Pa4,o=new ot._fP;this.node.matrixWorld.decompose(e,o,i);var n=new ot.yGw;return n.compose(e,o,new ot.Pa4(1,1,1)),t.applyMatrix4(n).toArray()}return this.node.localToWorld(t).toArray()},ot.Tme.prototype.getWorldAABB=function(){const t=this.getFromObjAabb(),e=t.getSize(dt),{x:n,y:i,z:o}=e;return{width:n,height:i,depth:o}},ot.Tme.prototype.getCenter=function(){const t=this.getFromObjAabb(),e=t.center(dt);return e},ot.Tme.prototype.getFromObjAabb=function(){const t=ut.setFromObject(this);return t},ot.Tme.prototype.setPickEnabled=function(t){this.pickEnabled=t},ot.Tme.prototype.getPickEnabled=function(){return void 0===this.pickEnabled||this.pickEnabled},ot.Tme.prototype.convertWorldToLocalPosition=function(t){let e;e=t.isVector3?t.clone():new ot.Pa4(t[0],t[1],t[2]);const n=this.worldToLocal(e);return[n.x,n.y,n.z]},ot.Tme.prototype.convertLocalToWorldPosition=function(t){let e;e=t.isVector3?t.clone():new ot.Pa4(t[0],t[1],t[2]),e=new ot.Pa4(t[0],t[1],t[2]);const n=this.localToWorld(e);return[n.x,n.y,n.z]},ot.Tme.prototype.setLocalPostion=function(t){let{x:e,z:n}=this.parent.position,i=new ot.Pa4(e+t[0],t[1],n+t[2]);this.position.set(i.x,i.y,i.z)},ot.Tme.prototype.destroy=function(){const t=this;this.traverse((function(e){"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose()),t.remove(e)})),this.parent.remove(this)},ot.Tme.prototype.setOpacity=function(t){this.material&&(this.material.opacity=t)},ot.Tme.prototype.destroyChildByName=function(t){const e=this;this.traverse((function(n){n.name===t&&(n instanceof ot.Kj0&&(n.geometry.dispose(),n.material.dispose()),e.remove(n))}))};var pt=n(4029),mt=n.n(pt);class ht extends ot.Kj0{constructor(t){const{_POINTS_:e,_RADIUS_:n}=t;let i=[];JSON.parse(e).forEach((t=>{i.push(new ot.Pa4(t[0],t[1],t[2]))}));const o=new ot.YT8(i),s=new ot.WXh(o,300,n||1,20,!1),a=new ot.Wid({color:65295,side:ot.ehD,transparent:!0});super(s,a),this.type="Lines"}}var ft=n(3971);function yt(t=0,e=0,n=0,i,{title:o,content:s}){const a=document.createElement("div"),{offsetWidth:r}=META.dom,{isScreen:l}=META,c=l?"120":.08*r,d=.23*c*.021;a.style.width=c+"px",a.style.height=l?"84px":.6*c+"px",a.style.padding=l?"3px 10px 25px 10px":`${d}px ${3*d}px ${d}px ${10*d}px`,a.style.color="#fff",a.style.background=`url(${window.baseImage}tip/orangeTip.png) no-repeat`,a.style.backgroundSize="100% 100%",a.style.fontSize=.23*c*.45+"px",a.style.position="absolute",a.style.zIndex=1;const u=new ft.j(a);u.position.x=t,u.position.y=e+1,u.position.z=n,u.name=i,a.style.pointerEvents="none";const p=`\n        <div>${o}</div>\n        <div style="margin-top: 10px;">${s}</div>\n    `;return a.innerHTML=p,u.visible=!0,u}function gt(t,e,n,i,{speed:o,traffic:s}){const a=document.createElement("div"),{offsetWidth:r}=META.dom,{isScreen:l}=META,c=l?120:.08*r,d=.23*c*.021;a.style.width=c+"px",a.style.height=l?"84px":.6*c+"px",a.style.padding=l?"17px 10px 10px 10px":`${d}px ${3*d}px ${d}px ${10*d}px`,a.style.color="#fff",a.style.background=`url(${window.baseImage}tip/greenTip.png) no-repeat`,a.style.backgroundSize="100% 100%",a.style.fontSize=.23*c*.45+"px",a.style.position="absolute",a.style.zIndex=1;const u=new ft.j(a);u.name=i,u.position.x=t,u.position.y=e+1,u.position.z=n,a.style.pointerEvents="none";const p=`\n       <div>平均车速：${o}KM</div>\n       <div>车流量：${s}辆</div>\n    `;return a.innerHTML=p,u.visible=!0,u}function vt(t,e,n,i,{title:o,content:s}){const a=document.createElement("div"),{offsetWidth:r}=META.dom,{isScreen:l}=META,c=.15*r,d=.23*c*.4,u=.2*c,p=.23*c*.061,m=.23*c*.021;a.style.width=.74*c+"px",a.style.height=.23*c+"px",a.style.padding=`${p}px 0px ${m}px ${u}px`,a.style.color="#fff",a.style.background=`url(${window.baseImage}tip/geomagnetism.png) no-repeat`,a.style.backgroundSize="100% 100%",a.style.fontSize=.23*c*.2+"px",a.style.position="absolute",a.style.zIndex=1;const h=new ft.j(a);h.name=i,h.position.x=t,h.position.y=e+1,h.position.z=n,a.style.pointerEvents="none";const f=`\n        <div>${o}</div>\n        <div><img style="width: ${d}px;\n        margin-top: ${l?"15px":"0px"};\n        margin-right:${l?"18px":"0px"} ;\n        float: left;" \n        src=${window.baseUrl}'/image/tip/alarmiIcon.png'> <span style="margin-top:${l?"31px":"0px"};\n        float: left;font-size:${.5*d}px">${s}</span></div>\n    `;return a.innerHTML=f,h.visible=!0,h}function wt(t,e,n,i,{title:o,content:s}){const a=document.createElement("div"),{isScreen:r}=META,{offsetWidth:l}=META.dom,c=.15*l,d=.23*c*.4,u=.23*c,p=.23*c*.1,m=.23*c*.061,h=.23*c*.021;a.style.width=.74*c+"px",a.style.height=.23*c+"px",a.style.padding=`${m}px ${u}px ${h}px ${p}px`,a.style.color="#fff",a.style.background=`url(${window.baseImage}tip/congestionTip.png) no-repeat`,a.style.backgroundSize="100% 100%",a.style.fontSize=.23*c*.2+"px",a.style.position="absolute",a.style.zIndex=1;const f=new ft.j(a);f.name=i,f.position.x=t,f.position.y=e+1,f.position.z=n,a.style.pointerEvents="none";const y=`\n        <div>${o}</div>\n        <div><img style="width: ${d}px;\n        margin-top: ${r?"35px":"5px"};\n        margin-right: ${r?"18px":"5px"} ;\n        float: left;" \n        src=${window.baseUrl}'/image/tip/alarmiIcon.png'> <span style="margin-top: ${r?"41px":"5px"};\n        float: left;font-size:${.5*d}px">${s}</span></div>\n    `;return a.innerHTML=y,f.visible=!0,f}function xt(t,e,n,i,{title:o,content:s}){const a=document.createElement("div"),{isScreen:r}=META,{offsetWidth:l}=META.dom,c=.15*l,d=.23*c*.4,u=.2*c,p=.23*c*.061,m=.23*c*.31;a.style.width=.74*c+"px",a.style.padding=`${p}px ${p}px ${m}px ${u}px`,a.style.color="#fff",a.style.background=`url(${window.baseImage}tip/geomagnetism.png) no-repeat`,a.style.backgroundSize="100% 100%",a.style.fontSize="10px",a.style.position="absolute",a.style.zIndex=1;const h=new ft.j(a);h.name=i,h.position.x=t,h.position.y=e+1,h.position.z=n,a.style.pointerEvents="none";const f=`\n        <div>${o}</div>\n        <div><img style="width: ${d}px;\n        margin-top:${r?"35px":"5px"};\n        margin-right: ${r?"18px":"0px"};\n        float: left;" \n        src=${window.baseUrl}'/image/tip/alarmiIcon.png'> <span style="margin-top: ${r?"41px":"5px"};\n        float: left;font-size:${.5*d}px">${s}</span></div>\n        \n        \n        </div>\n        <div><img style="    width: 100%;\n        margin-top: ${r?"11px":"5px"};\n        margin-right: ${r?"3px":"0px"};\n        float: left;" \n        src=${window.baseImage}'tip/carAlarm.png'></div>\n    `;return a.innerHTML=f,h.visible=!0,h}let bt=[],Tt=[];const Mt=["对象019","对象021"];function Et(t){bt=[{type:"magnetic",x:t?-47:-50,y:100,z:-932,data:{title:"#RUF1232",content:"地磁车检器离线"}},{type:"car",x:t?-34:-45,y:100,z:t?-850:-902,data:{speed:"64",traffic:"1325"}},{type:"car",x:t?-60:-54,y:100,z:t?-1012:-962,data:{speed:"63",traffic:"1325"}},{type:"car",x:t?-31:-35,y:100,z:t?-917:-925,data:{speed:"65",traffic:"123"}},{type:"car",x:t?-18:-31,y:100,z:t?-827:-895,data:{speed:"89",traffic:"1326"}},{type:"car",x:t?-42:-40,y:100,z:t?-1e3:-955,data:{speed:"65",traffic:"1327"}}],Tt=[{type:"geomagneticCity",x:t?650:270,y:300,z:t?-2532:-1900,data:{title:"#ZK03+40 ZCJ01",content:"地磁车检器离线"}},{type:"jamAlarm",x:t?0:250,y:-250,z:t?0:-232,data:{title:"#ZK3+40",content:"拥堵报警"}},{type:"carAccident",x:t?0:-501,y:t?-470:-250,z:t?3532:2732,data:{title:"#ZK3+40",content:"追车辆尾报警"}}]}function St(){const t=window.META;bt.forEach(((e,n)=>{const{x:i,y:o,z:s,data:a}=e;"car"===e.type?t.scene.add(gt(i,o,s,e.type+n+"default",a)):t.scene.add(yt(i,o,s,e.type+n+"default",a))})),Mt.forEach((e=>{const n=t.scene.getObjectByName(e);n.visible=!1}))}function Pt(){const t=window.META;bt.forEach(((e,n)=>{const i=e.type+n+"default",o=t.scene.getObjectByName(i);t.scene.remove(o)})),Mt.forEach((e=>{const n=t.scene.getObjectByName(e);n.visible=!0}))}function Ct(){const t=window.META.scene.getObjectByName("对象001");Tt.forEach(((e,n)=>{const{x:i,y:o,z:s,data:a}=e;"geomagneticCity"===e.type?t.add(vt(i,o,s,e.type+n+"default",a)):"jamAlarm"===e.type?t.add(wt(i,o,s,e.type+n+"default",a)):"carAccident"===e.type&&t.add(xt(i,o,s,e.type+n+"default",a))}))}function At(){const t=window.META,e=t.scene.getObjectByName("对象001");Tt.forEach(((n,i)=>{const o=n.type+i+"default",s=t.scene.getObjectByName(o);e.remove(s)}))}window.tunnelDefault=St;class _t{constructor(t){this.app=t,this.mouse=new ot.FM8,this.raycaster=new ot.iMs,this.scene=this.app.scene.getObjectByName("pyScene")||this.app.scene,this.selectedObject=[],this.rootObj=null,this.count=0,this.timer=null,this.flyEnd=!0,this.init()}init(){this.app.dom.addEventListener("click",this.addOnClick),this.app.dom.addEventListener("dblclick",this.onLeftDbClick),this.app.dom.oncontextmenu=this.rightDbCLick}getRootObj(){return META.eventInput.rootObj}addOnClick(t){t.preventDefault(),META.eventInput.mouse.x=t.clientX/window.innerWidth*2-1,META.eventInput.mouse.y=-t.clientY/window.innerHeight*2+1,META.eventInput.raycaster.setFromCamera(META.eventInput.mouse,META.camera);const e=META.eventInput.getPickObj(META.eventInput.raycaster.intersectObject(META.eventInput.scene,!0));e?(META.outLinePass.selectedObjects=[],META.eventInput.rootObj=e):(META.outLinePass.selectedObjects=[],META.eventInput.rootObj=null)}onLeftDbClick(t){t.preventDefault(),META.eventInput.mouse.x=t.clientX/window.innerWidth*2-1,META.eventInput.mouse.y=-t.clientY/window.innerHeight*2+1,META.eventInput.raycaster.setFromCamera(META.eventInput.mouse,META.camera);const e=META.eventInput.getPickObj(META.eventInput.raycaster.intersectObject(META.eventInput.scene,!0));e&&META.eventInput.flyEnd&&(At(),META.eventInput.flyEnd=!1,META.fly.flyTo(e,(()=>{e instanceof ht&&(META.isFlyControls=!0),META.eventInput.flyEnd=!0,St()})))}rightDbCLick(t){META.eventInput.flyEnd&&(META.eventInput.count+=1,META.eventInput.timer=setTimeout((function(){clearTimeout(META.eventInput.timer),META.eventInput.count>1&&(META.eventInput.count=0,META.eventInput.flyEnd=!1,Pt(),META.fly.flyTo("default",(()=>{META.isFlyControls=!1,META.eventInput.flyEnd=!0,Ct()}))),META.eventInput.count=0}),200))}onPointerMove(t){META.eventInput.mouse.x=t.clientX/window.innerWidth*2-1,META.eventInput.mouse.y=-t.clientY/window.innerHeight*2+1,META.eventInput.raycaster.setFromCamera(META.eventInput.mouse,META.camera);const e=eventLists.getPickObj(META.eventInput.raycaster.intersectObject(META.scene,!0));META.outLinePass.selectedObjects=e||[]}getPickObj(t=[]){let e=null;return t.forEach((({object:t})=>{t&&!t.getPickEnabled()||(e=t)})),e}}var zt=_t,jt=n(6903);const Ot=()=>new Promise((t=>{const e=[{id:"demo",url:"/models/demo/demo0528.gltf",name:"demo"}];t(e)})),It=()=>new Promise((t=>{const e=[{id:"20010",url:"/material/grid/hardwood2_bump.jpg",name:"hardwood2_bump"},{id:"20011",url:"/material/grid/hardwood2_diffuse.jpg",name:"hardwood2_diffuse"},{id:"20012",url:"/material/grid/hardwood2_roughness.jpg",name:"hardwood2_roughness"},{id:"20013",url:"/material/test.jpg",name:"test"},{id:"20017",url:"/textures/grasslight-big.jpg",name:"grasslight"}];t(e)})),kt=new jt.E,Lt=new ot.dpR;class $t{constructor(){this.productModelLists=[],this.productMaterialsList=[],this.productModelObjs={},this.materialsObjs={},this.parkObj=null}async loadModels(){const t=this;this.productModelLists=await Ot(),await Promise.all(t.productModelLists.map((async e=>{let n=await t.loadModel(e.url);t.productModelObjs[e.name]=n})))}setParkObj(t){this.parkObj=t}getParkChildNams(t){return this.parkObj.getChildByName(t)}async loadModel(t){return new Promise((e=>{kt.load(t,(t=>{e(t)}))}))}async loadMaterials(){const t=this;this.productMaterialsList=await It(),await Promise.all(t.productMaterialsList.map((async e=>{const n=await t.loadMaterial(e.url);t.materialsObjs[e.name]=n})))}async loadMaterial(t){return new Promise((e=>{const n=Lt.load(t);e(n)}))}getMaterialByName(t){return this.materialsObjs[t]}getModelByName(t){return this.productModelObjs[t]}getProduct(){}}var Ft=n(6166),Dt=n.n(Ft);function Bt(){return"TOKEN-XXX"}const Rt=Dt().create({baseURL:"",timeout:5e3});function Nt(t,e){Rt({url:t,method:"post",params:e})}Rt.interceptors.request.use((t=>{const e=Bt();return e&&(t.headers["X-Token"]=e),t}),(t=>Promise.reject(t))),Rt.interceptors.response.use((t=>{let e=t;return 200!==e.status?(o.Message.error(e.message||"接口异常"),Promise.reject(e.message||"接口异常")):e.data}));const Wt=t=>META.isMock?new Promise((e=>{mt().getJSON(`/mocks/getCi_${t}.json`,(t=>{e(t)}))})):Nt("/query/ci",{id:t});class Ht extends ot.Tme{constructor(t){super(t),this.type="Device",this.actions={};const{_PRODUCT_:e,_OFFSET_:n,_STYLE_:i,_NAME_:o,_ISPICK_:s}=t,a=META.productManager.getParkChildNams(e);if(a){if(this.animations=a.animations,this.isAnimations()&&this.creatAnimations(a.scene,a.animations),this.lastActiveAction=null,i)for(const t in i)a.material[t]=i[t];if(this.copy(a.material),this.name=o,this.setPickEnabled(void 0===s||s),n){const t=JSON.parse(n);this.position.set(t[0],t[1],t[2])}}}init(){}isAnimations(){return this.animations.length>0}creatAnimations(t,e){const n=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],i=["Jump","Yes","No","Wave","Punch","ThumbsUp"],o=new ot.Xcj(t);for(let s=0;s<e.length;s++){const t=e[s],a=o.clipAction(t);this.actions[t.name]=a,(i.indexOf(t.name)>=0||n.indexOf(t.name)>=4)&&(a.clampWhenFinished=!0,a.loop=ot.jAl)}this.fadeToAction()}fadeToAction(t="Walking",e=.2){const n=this;this.actions[t]&&(this.lastActiveAction?(this.lastActiveAction.fadeOut(e),this.actions[t].reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(e).play(),this.lastActiveAction=this.actions[t]):setInterval((()=>{n.actions[t].play()}),300))}}class Kt extends ot.Kj0{constructor(t){const{start:e,end:n,height:i,depth:o,PARENTWIDTH:s,PARENTDEPAT:a}=t,r=lt(e[0],n[0],e[1],n[1]),l=rt(e[0],n[0],e[1],n[1]),c=new ot.bnF;c.moveTo(-o,-0),c.lineTo(-o,i),c.lineTo(r,i),c.lineTo(r,-0),c.lineTo(-o,-0);for(let m in t._CHILDREN_){const{_PRODUCT_:e,_LOCATION_:n}=t._CHILDREN_[m],i=META.productManager.getModelByName(e).scene,{width:o,height:s}=i&&i.getWorldAABB(),a=Kt.setDoorPosit(Number(n),o,s);c.holes.push(a)}const d={depth:o,bevelEnabled:!1,bevelThickness:1,bevelSize:0,bevelSegments:1},u=new ot.O7d(c,d);super(u,new ot.xoR({color:16777215,roughness:.5,side:ot.ehD,transparent:!0,opacity:.5,metalness:.5})),u.center();const p=at(e,n);0!==l&&180!==l&&(this.rotation.y=l/180*Math.PI),this.opacity=.5,this.position.set(p[0]-s/2,i/2,p[1]+a/2-4),this.type="Wall"}static setDoorPosit(t,e,n){const i=new ot.y$t,o=t-e/2,s=t+e/2;return i.moveTo(o,0),i.lineTo(o,n),i.lineTo(s,n),i.lineTo(s,0),i.lineTo(o,0),i}}class Zt extends ot.Kj0{constructor(t){const e=new ot.Wid({side:ot.Wl3,color:16777215*Math.random()}),{WIDTH:n=100,HEIGHT:i=200,DEPAT:o=100,_OFFSET_:s}=t,a=new ot.nvb(n,i,o);if(super(a,e),this.type="Box",s){const t=JSON.parse(s);this.position.set(t[0],i/2,t[2])}this.castShadow=!0,this.receiveShadow=!0}}class Gt extends ot.Tme{constructor(t){super(t),this.type="Park",this.actions={};const{_PRODUCT_:e,_OFFSET_:n}=t;if(e.length>0){const t=META.productManager.getParkChildNams(e)||META.productManager.getModelByName(e).scene;if(this.animations=t.animations,this.lastActiveAction=null,this.copy(t),t.remove(),n){const t=JSON.parse(n);this.position.set(t[0],t[1],t[2])}}}init(){}}var Yt=n(3796);class Ut extends ot.SPe{constructor(t){const e=[{pos:[40*Math.random()-20,40*Math.random()-20,40*Math.random()-20],rotations:[0,0,0],scales:[1,1,1]}],n=new ot.DvJ(1,1,1),i=new ot.Wid({color:2200782,roughness:.5,metalness:0});super(n,i,e.length),(0,Yt.Z)(this,"randomizeMatrix",function(t=[0,0,0],e=[1,1,1]){const n=new ot.Pa4,i=new ot.USm,o=new ot._fP,s=new ot.Pa4;return function(a){n.x=40*Math.random()-20,n.y=40*Math.random()-20,n.z=40*Math.random()-20,i.x=t[0],i.y=t[1],i.z=t[2],o.setFromEuler(i),s.x=e[0],s.y=e[1],s.z=e[2],a.compose(n,o,s)}}()),this.type="instancedEx",this.makeInstanced();const o=JSON.parse(t._OFFSET_);this.position.set(o[0],o[1]+10,o[2]),this.type="Instanced"}makeInstanced(t=[]){const e=this,n=new ot.yGw;t.forEach(((t,i)=>{e.randomizeMatrix(t.pos,t.rotations,t.scales),e.setMatrixAt(i,n)}))}getInstancedId(){}}class Jt extends ot.ZAu{constructor(t){super(t),this.type="GroupEx";const{_OFFSET_:e}=t;if(e){const t=JSON.parse(e);this.position.set(t[0],t[1],t[2])}}}const Xt=()=>{};Xt.objTypes={Walls:Kt,Device:Ht,Box:Zt,Lines:ht,InstancedEx:Ut,Park:Gt,Group:Jt},Xt.setType=(t,e)=>{Xt.objTypes[t]=e},Xt.getObjTypes=t=>Xt.objTypes[t],Xt.create=t=>{let e=new Xt.objTypes[t.type](t.param);return e.userData=t.param,t.complete&&(t.complete(e),delete t.complete),e};var qt=Xt;const Vt=()=>{};Vt.objs={},Vt.createObject=t=>{const{_PARENTDBID_:e,_ID_:n,_TYPE_:i}=t,o=qt.create({type:i,complete:()=>{},param:t});n&&(Vt.objs[n]=o);const s=Vt.objs[e];s?s.add(o):META.scene.add(o),o.init&&o.init()},Vt.getObjectByDbid=t=>Vt.objs[t],Vt.getCis=(t,e)=>{Wt(t).then((async t=>{let n=100/t.length;n>0&&(n=parseInt(n)),Vt.recursiveObj(t,n),e&&e()}))},Vt.recursiveObj=(t,e)=>{for(let n in t){let i=t[n];i._TYPE_&&Vt.createObject(i),(i._TYPE_||i._CHILDREN_)&&i._CHILDREN_&&Vt.recursiveObj(i._CHILDREN_,e)}};var Qt=Vt,te=n(6876),ee=n(8595),ne=n(1740),ie=n(8227),oe=n(8721);const se={exposure:1.2,bloomStrength:.1,bloomThreshold:.6,bloomRadius:.6};class ae{constructor(t){this.app=t,this.pass=new oe.C,this.outLinePass=new ne.f(new ot.FM8(t.dom.offsetWidth,t.dom.offsetHeight),t.scene,t.camera),this.bloomPass=new ie.m(new ot.FM8(t.dom.offsetWidth,t.dom.offsetHeight),1.5,.4,.85),this.initOutLine(),this.addPointLight(),this.addBackgroundImg(window.baseImage+"curtain.png")}addHemiLight(){const t=new ot.Ox3(16777215,1);t.color.setHSL(.1,1,.95),t.position.set(-1,1.75,1),t.position.multiplyScalar(30),this.app.scene.add(t),t.castShadow=!0}setFloor(t){Utils.forMaterial(t.material,(t=>{t.color.setStyle("#040912")}))}addRrdinaryGrid(){const t=(new ot.dpR).load("/textures/hardwood2_bump.jpg"),e=new ot._12(1e4,1e4),n=new ot.xoR({color:8421504,map:t}),i=new ot.Kj0(e,n);i.rotation.x=-Math.PI/2,i.material.map.repeat.set(8,8),i.material.map.wrapS=i.material.map.wrapT=ot.rpg,i.material.map.encoding=ot.knz,i.receiveShadow=!0,this.app.scene.add(i)}addPointLight(){const t=new ot.xo$(0,16,8),e=new ot.cek(16777215,2,0,2),n=new ot.Wid({emissive:16777198,emissiveIntensity:1,color:0});e.add(new ot.Kj0(t,n)),e.position.set(3006.452849809113,3466.627800031605,38.7962564494514),e.castShadow=!0,this.app.scene.add(e);const i=new ot.vmT(16777215,16777215,.8);this.app.scene.add(i)}addFog(){this.app.scene.fog=new ot.ybr(16777215,100,16e4)}addSkyBoxCubemap(t="/effectBox/skyboxPolar"){const e=new ot.cBK,n=e.load([t+"/Sky_Space_Right.jpg",t+"/Sky_Space_Left.jpg",t+"/Sky_Space_Up.jpg",t+"/Sky_Space_Down.jpg",t+"/Sky_Space_Back.jpg",t+"/Sky_Space_Front.jpg"]);this.app.scene.background=n}addPlaneGrid(){const t=new ot.BKK(1e4,1e4),e=new ot.xoR,n=new ot.Kj0(t,e);n.name="grid",n.material.color.setStyle("#f8f8f8"),n.rotation.x=-Math.PI/2,n.receiveShadow=!0,this.app.scene.add(n)}addCircleGrid(){const t=new ot.zf8(5e3,60),e=new ot.vBJ({color:16776960}),n=new ot.Kj0(t,e);n.rotation.x=-Math.PI/2,n.receiveShadow=!0,this.app.scene.add(n)}addBackground(t){this.app.scene.background=new ot.Ilk(t||"#0e1829")}addBackgroundImg(t){const e=new ot.dpR,n=e.load(t);this.app.scene.background=n}initOutLine(){this.outLinePass.edgeStrength=Number(10),this.outLinePass.edgeGlow=Number(.5),this.outLinePass.edgeThickness=Number(2.5),this.outLinePass.pulsePeriod=Number(2.5),this.outLinePass.visibleEdgeColor.set("#ed8e00"),this.app.composer.addPass(this.outLinePass),this.app.outLinePass=this.outLinePass}initBoom(){this.bloomPass.threshold=se.bloomThreshold,this.bloomPass.strength=se.bloomStrength,this.bloomPass.radius=se.bloomRadius,this.app.composer.addPass(this.bloomPass)}effectGlitchPass(){this.pass.renderToScreen=!0,this.app.composer.addPass(this.pass)}}var re={surroundLineGeometry(t){return new ot.TOt(t.geometry)}};const le="\nprecision mediump float;\n\nfloat distanceTo(vec2 src, vec2 dst) {\n    float dx = src.x - dst.x;\n    float dy = src.y - dst.y;\n    float dv = dx * dx + dy * dy;\n    return sqrt(dv);\n} \n\nfloat lerp(float x, float y, float t) {\n    return (1.0 - t) * x + t * y;\n}\n\n#define PI 3.14159265359\n#define PI2 6.28318530718\n\n",ce={vertexShader:"\n    #define PI 3.14159265359\n\n    uniform mediump float uStartTime;\n    uniform mediump float time;\n    uniform mediump float uRange;\n    uniform mediump float uSpeed;\n\n    uniform vec3 uColor;\n    uniform vec3 uActive;\n    uniform vec3 uMin;\n    uniform vec3 uMax;\n\n    varying vec3 vColor;\n\n    float lerp(float x, float y, float t) {\n        return (1.0 - t) * x + t * y;\n    }\n    void main() { \n        if (uStartTime >= 0.99) {\n            float iTime = mod(time * uSpeed - uStartTime, 1.0);\n            float rangeY = lerp(uMin.y, uMax.y, iTime);\n            if (rangeY < position.y && rangeY > position.y - uRange) {\n                float index = 1.0 - sin((position.y - rangeY) / uRange * PI);\n                float r = lerp(uActive.r, uColor.r, index);\n                float g = lerp(uActive.g, uColor.g, index);\n                float b = lerp(uActive.b, uColor.b, index);\n\n                vColor = vec3(r, g, b);\n            } else {\n                vColor = uColor;\n            }\n        }\n        vec3 vPosition = vec3(position.x, position.y, position.z * uStartTime);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n    } \n    ",fragmentShader:` \n    ${le} \n    uniform float time;\n    uniform float uOpacity;\n    uniform float uStartTime;\n\n    varying vec3 vColor; \n\n    void main() {\n\n        gl_FragColor = vec4(vColor, uOpacity * uStartTime);\n    }\n    `};var de={base:le,surroundLine:ce},ue={forMaterial(t,e){if(!e||!t)return!1;Array.isArray(t)?t.forEach((t=>{e(t)})):e(t)}};const pe="\nprecision mediump float;\n \nfloat atan2(float y, float x){\n  float t0, t1, t2, t3, t4;\n  t3 = abs(x);\n  t1 = abs(y);\n  t0 = max(t3, t1);\n  t1 = min(t3, t1);\n  t3 = float(1) / t0;\n  t3 = t1 * t3;\n  t4 = t3 * t3;\n  t0 = -float(0.013480470);\n  t0 = t0 * t4 + float(0.057477314);\n  t0 = t0 * t4 - float(0.121239071);\n  t0 = t0 * t4 + float(0.195635925);\n  t0 = t0 * t4 - float(0.332994597);\n  t0 = t0 * t4 + float(0.999995630);\n  t3 = t0 * t3;\n  t3 = (abs(y) > abs(x)) ? float(1.570796327) - t3 : t3;\n  t3 = (x < 0.0) ?  float(3.141592654) - t3 : t3;\n  t3 = (y < 0.0) ? -t3 : t3;\n  return t3;\n}\n// 计算距离\nfloat distanceTo(vec2 src, vec2 dst) {\n\tfloat dx = src.x - dst.x;\n\tfloat dy = src.y - dst.y;\n\tfloat dv = dx * dx + dy * dy;\n\treturn sqrt(dv);\n}\n\n#define PI 3.14159265359\n#define PI2 6.28318530718\n\nuniform vec3 u_color;\nuniform float time;\nuniform float u_opacity;\nuniform float u_radius;\nuniform float u_width;\nuniform float u_speed;\n\nvarying vec2 v_position;\n\n    ",me={vertexShader:"\n    varying vec2 v_position;\n    \n    void main() {\n        v_position = vec2(position.x, position.y);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }",fragmentShader:`\n    ${pe} \n    void main() {\n        float d_time = u_speed * time;\n\n        float angle = atan2(v_position.x, v_position.y) + PI;\n        \n        float angleT = mod(angle + d_time, PI2);\n\n        float width = u_width;\n    \n        float d_opacity = 0.0;\n\n        // 当前位置离中心位置\n        float length = distanceTo(vec2(0.0, 0.0), v_position);\n        \n        float bw = 5.0;\n        if (length < u_radius && length > u_radius - bw) {\n            float o = (length - (u_radius - bw)) / bw;\n            d_opacity = sin(o * PI); \n        }\n\n        if (length < u_radius - bw / 1.1) {\n            d_opacity = 1.0 - angleT / PI * (PI / width);\n        } \n\n        if (length > u_radius) { d_opacity = 0.0; }\n \n        gl_FragColor = vec4(u_color, d_opacity * u_opacity);\n    }`};function he(t){const{radius:e=50,color:n="#fff",speed:i=1,opacity:o=1,angle:s=Math.PI,position:a={x:0,y:0,z:0},rotation:r={x:-Math.PI/2,y:0,z:0}}=t,l=2*e,c=new ot.BKK(l,l,1,1),d=new ot.jyz({uniforms:{u_radius:{value:e},u_speed:{value:i},u_opacity:{value:o},u_width:{value:s},u_color:{value:new ot.Ilk(n)},time:{value:0}},transparent:!0,depthWrite:!1,side:ot.ehD,vertexShader:me.vertexShader,fragmentShader:me.fragmentShader}),u=new ot.Kj0(c,d);return u.rotation.set(r.x,r.y,r.z),u.position.copy(a),u}const fe="\nuniform vec3 u_color;\n\nuniform float time;\nuniform float u_height;\n \nvarying float v_opacity;\n\nvoid main() {\n\n    vec3 vPosition = position * mod(time, 1.0);\n\n    v_opacity = mix(1.0, 0.0, position.y / u_height);\n \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n}\n",ye=" \nuniform vec3 u_color;\nuniform float u_opacity;\n \nvarying float v_opacity;\n\nvoid main() { \n    gl_FragColor = vec4(u_color, v_opacity * u_opacity);\n}\n";function ge(t={}){const{radius:e,height:n,opacity:i,color:o,speed:s,renderOrder:a}=t,r=new ot.fHI(e,e,n,32,1,!0);r.translate(0,n/2,0);const l=new ot.jyz({uniforms:{u_height:{value:n},u_speed:{value:s||1},u_opacity:{value:i},u_color:{value:new ot.Ilk(o)},time:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1,side:ot.ehD,vertexShader:fe,fragmentShader:ye}),c=new ot.Kj0(r,l);return c.renderOrder=a||1,c}function ve(t){const{source:e,target:n,height:i,size:o,color:s,range:a}=t,r=[],l=[],c=[],d=[],u=new ot.Pa4(e.x,e.y,e.z),p=new ot.Pa4(n.x,n.y,n.z),m=p.clone().lerp(u,.5);m.y+=i;const h=parseInt(u.distanceTo(m)+p.distanceTo(m)),f=new ot.mXe(u,m,p),y=f.getPoints(h);y.forEach(((t,e)=>{const n=e/(h-1);r.push({x:t.x,y:t.y,z:t.z}),c.push(n),d.push(e)})),r.forEach((t=>{l.push(t.x,t.y,t.z)}));const g=new ot.u9r;g.setAttribute("position",new ot.a$l(l,3)),g.setAttribute("index",new ot.a$l(c,1)),g.setAttribute("current",new ot.a$l(d,1));const v=new ot.jyz({transparent:!0,depthWrite:!1,depthTest:!1,blending:ot.WMw,uniforms:{uColor:{value:new ot.Ilk(s)},uRange:{value:a||100},uSize:{value:o},uTotal:{value:h},time:{value:0}},vertexShader:"\n        attribute float index;\n        attribute float current;\n        uniform float time;\n        uniform float uSize;\n        uniform float uRange; // 展示区间\n        uniform float uTotal; // 粒子总数\n        uniform vec3 uColor; \n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            // 需要当前显示的索引\n            float size = uSize;\n            float showNumber = uTotal * mod(time, 1.1);\n            if (showNumber > current && showNumber < current + uRange) {\n                float uIndex = ((current + uRange) - showNumber) / uRange;\n                size *= uIndex;\n                vOpacity = 1.0;\n            } else {\n                vOpacity = 0.0;\n            }\n\n            // 顶点着色器计算后的Position\n            vColor = uColor;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition; \n            // 大小\n            gl_PointSize = size * 300.0 / (-mvPosition.z);\n        }",fragmentShader:"\n        varying vec3 vColor; \n        varying float vOpacity;\n        void main() {\n            gl_FragColor = vec4(vColor, vOpacity);\n        }"}),w=new ot.woe(g,v);return w}const we=[{position:{x:666,y:22,z:0},radius:150,color:"#ff0000",opacity:.5,speed:2},{position:{x:200,y:25,z:2466},radius:220,color:"#efad35",opacity:.5,speed:1}],xe=[{position:{x:-150,y:15,z:100},speed:.5,color:"#efad35",opacity:.9,radius:5e3,height:220,renderOrder:5}],be=[{source:{x:-150,y:15,z:100},target:{x:200,y:25,z:2466},range:120,height:100,color:"#efad35",speed:1,size:30},{source:{x:-150,y:15,z:100},target:{x:666,y:22,z:0},height:300,range:150,color:"#ff0000",speed:1,size:40}];class Te{constructor(t,e){(0,Yt.Z)(this,"animate",(t=>{if(t>1)return!1;this.time.value+=t,this.isStart&&(this.StartTime.value+=.5*t,this.StartTime.value>=1&&(this.StartTime.value=1,this.isStart=!1))})),this.app=t,this.gltfLoader=new jt.E,this.group=new ot.ZAu,this.effectMap={"对象001":{opacity:.6,uColor:"#4C8BF5",uActiveColor:"#fff"},"对象002":{opacity:1,uColor:"#4C8BF5",uActiveColor:"#fff"}},this.effectGroup=new ot.ZAu,this.group.add(this.effectGroup),this.surroundLineMaterial=null,this.time={value:0},this.StartTime={value:0},this.isStart=!1,this.loadScene(e)}loadeffect(){for(let t in this.effectMap){const e=this.effectMap[t],n=this.app.scene.getObjectByName(t);n&&(n.opacity=e.opacity,this.setCityMaterial(n),this.surroundLine(n,e))}this.init()}loadScene(t){this.loadGltf(window.baseSceneUrl).then((e=>{e.position.setY(108),e.name="pyScene",this.group.add(e);const n=this.group.getObjectByName("对象001");n.setPickEnabled(!1),n.setOpacity(.3),t&&t()}))}loadGltf(t){return new Promise(((e,n)=>{try{this.gltfLoader.load(t,(t=>{e(t.scene)}))}catch(i){n(i)}}))}init(){this.isStart=!0,we.forEach((t=>{const e=he(t);e.material.uniforms.time=this.time,this.effectGroup.add(e)})),xe.forEach((t=>{const e=ge(t);e.material.uniforms.time=this.time,this.effectGroup.add(e)})),be.forEach((t=>{const e=ve(t);e.material.uniforms.time=this.time,e.renderOrder=10,this.effectGroup.add(e)}))}setCityMaterial(t){t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere();const{geometry:e}=t,{center:n,radius:i}=e.boundingSphere,{max:o,min:s}=e.boundingBox,a=new ot.Pa4(o.x-s.x,o.y-s.y,o.z-s.z);ue.forMaterial(t.material,(t=>{t.opacity=.6,t.transparent=!0,t.color.setStyle("#1B3045"),t.onBeforeCompile=t=>{t.uniforms.time=this.time,t.uniforms.uStartTime=this.StartTime,t.uniforms.uCenter={value:n},t.uniforms.uSize={value:a},t.uniforms.uMax={value:o},t.uniforms.uMin={value:s},t.uniforms.uTopColor={value:new ot.Ilk("#FFFFDC")},t.uniforms.uSwitch={value:new ot.Pa4(0,0,0)},t.uniforms.uDiffusion={value:new ot.Pa4(1,120,600)},t.uniforms.uDiffusionCenter={value:new ot.Pa4(0,0,0)},t.uniforms.uFlow={value:new ot.Pa4(1,10,20)},t.uniforms.uColor={value:new ot.Ilk("#5588aa")},t.uniforms.uFlowColor={value:new ot.Ilk("#5588AA")},t.uniforms.uOpacity={value:1},t.uniforms.uRadius={value:i};const e="\n    float distanceTo(vec2 src, vec2 dst) {\n        float dx = src.x - dst.x;\n        float dy = src.y - dst.y;\n        float dv = dx * dx + dy * dy;\n        return sqrt(dv);\n    }\n\n    float lerp(float x, float y, float t) {\n        return (1.0 - t) * x + t * y;\n    }\n\n    vec3 getGradientColor(vec3 color1, vec3 color2, float index) {\n        float r = lerp(color1.r, color2.r, index);\n        float g = lerp(color1.g, color2.g, index);\n        float b = lerp(color1.b, color2.b, index);\n        return vec3(r, g, b);\n    }\n\n    varying vec4 vPositionMatrix;\n    varying vec3 vPosition;\n\n    uniform float time;\n    // 扩散参数\n    uniform float uRadius;\n    uniform float uOpacity;\n    // 初始动画参数\n    uniform float uStartTime; \n\n    uniform vec3 uMin;\n    uniform vec3 uMax;\n    uniform vec3 uSize;\n    uniform vec3 uFlow;\n    uniform vec3 uColor;\n    uniform vec3 uCenter;\n    uniform vec3 uSwitch;\n    uniform vec3 uTopColor;\n    uniform vec3 uFlowColor;\n    uniform vec3 uDiffusion; \n    uniform vec3 uDiffusionCenter;\n\n    void main() {\n        ",r="\n    vec3 distColor = outgoingLight;\n    float dstOpacity = diffuseColor.a;\n    \n    float indexMix = vPosition.z / (uSize.z * 0.6);\n    distColor = mix(distColor, uTopColor, indexMix);\n    \n    // 开启扩散波\n    vec2 position2D = vec2(vPosition.x, vPosition.y);\n    if (uDiffusion.x > 0.5) {\n        // 扩散速度\n        float dTime = mod(time * uDiffusion.z, uRadius * 2.0);\n        // 当前的离中心点距离\n        float uLen = distanceTo(position2D, vec2(uCenter.x, uCenter.z));\n\n        // 扩散范围\n        if (uLen < dTime && uLen > dTime - uDiffusion.y) {\n            // 颜色渐变\n            float dIndex = sin((dTime - uLen) / uDiffusion.y * PI);\n            distColor = mix(uColor, distColor, 1.0 - dIndex);\n        }\n    }\n\n    // 流动效果\n    if (uFlow.x > 0.5) {\n        // 扩散速度\n        float dTime = mod(time * uFlow.z, uSize.z); \n        // 流动范围\n        float topY = vPosition.z + uFlow.y;\n        if (dTime > vPosition.z && dTime < topY) {\n            // 颜色渐变 \n            float dIndex = sin((topY - dTime) / uFlow.y * PI);\n\n            distColor = mix(distColor, uFlowColor,  dIndex); \n        }\n    }\n  \n\n    gl_FragColor = vec4(distColor, dstOpacity * uStartTime);\n        ";t.fragmentShader=t.fragmentShader.replace("void main() {",e),t.fragmentShader=t.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );",r);const l="\n    varying vec4 vPositionMatrix;\n    varying vec3 vPosition;\n    uniform float uStartTime;\n    void main() {\n            vPositionMatrix = projectionMatrix * vec4(position, 1.0);\n            vPosition = position;\n            ",c="\n    vec3 transformed = vec3(position.x, position.y, position.z * uStartTime);\n            ";t.vertexShader=t.vertexShader.replace("void main() {",l),t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",c)}}))}surroundLine(t,{opacity:e=.6,uColor:n="#4C8BF5",uActiveColor:i="#fff"}){const o=re.surroundLineGeometry(t),s=new ot.Pa4;t.getWorldPosition(s);const{max:a,min:r}=t.geometry.boundingBox,l=new ot.Pa4(a.x-r.x,a.y-r.y,a.z-r.z),c=this.createSurroundLineMaterial({max:a,min:r,size:l,opacity:e,uColor:n,uActiveColor:i}),d=new ot.ejS(o,c);d.name="surroundLine",d.scale.copy(t.scale),d.rotation.copy(t.rotation),d.position.copy(s),this.effectGroup.add(d)}createSurroundLineMaterial({max:t,min:e,size:n,opacity:i=.6,uColor:o="#4C8BF5",uActiveColor:s="#fff"}){return this.surroundLineMaterial=new ot.jyz({transparent:!0,uniforms:{uColor:{value:new ot.Ilk(o)},uActive:{value:new ot.Ilk(s)},time:this.time,uOpacity:{value:i},uMax:{value:t},uMin:{value:e},uRange:{value:200},uSpeed:{value:.2},uStartTime:this.StartTime},vertexShader:de.surroundLine.vertexShader,fragmentShader:de.surroundLine.fragmentShader}),this.surroundLineMaterial}}var Me=Te,Ee=n(3448),Se=n(8349),Pe=(n(6699),n(8675),n(3462),n(7272));class Ce{constructor(t){this.app=t,this.controls=t.render.controls,this.camera=t.camera,this.current={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z,x1:this.controls.target.x,y1:this.controls.target.y,z1:this.controls.target.z},this.customizedObj={"对象002":{x:-439,y:451,z:4881,x1:0,y1:0,z1:0},default:{x:-3641,y:2199,z:-77,x1:0,y1:0,z1:0},tunnel:{x:-114,y:176,z:-920,x1:-46,y1:120,z1:-932}},this.tunnelArray=["对象011","对象012","对象013","对象014","对象015","对象016","对象017","对象018","对象019","对象020","对象021","对象022","对象023","对象024","对象025","对象026"]}getCustomizedPos(t){return this.tunnelArray.includes(t)&&(t="tunnel"),this.customizedObj[t]}getResultData(t){let e={};if("object"===typeof t){const{x:n,y:i,z:o}=t.getCenter&&t.getCenter(),s=t instanceof ht?[30,20,30]:[300,500,300];e=this.getCustomizedPos(t.name)||{x:n+s[0],y:i+s[1],z:o+s[2],x1:n,y1:i,z1:o}}else e=this.getCustomizedPos(t);return e}flyTo(t,e){const n=this.getResultData(t);this.tween=new Pe.kX(this.current),this.tween.onComplete((()=>{let t=new ot.Pa4(n.x1,n.y1,n.z1);e&&e(),this.controls.target=t})),this.tween.onUpdate((()=>{META.fly.update()})),this.tween.to(n,1500),this.tween.start()}update(){this.camera.position.set(this.current.x,this.current.y,this.current.z),this.camera.lookAt(this.current.x1,this.current.y1,this.current.z1)}animate(t){this.tween&&this.tween.update(),this.mixer&&this.mixer.update(t)}motion(){const t=new ot.DvJ(5,5,5),e=new ot.Kj0(t,new ot.YBo({color:255}));this.app.scene.add(e),e.position.set(-10,-50,-50);const n=new ot.YT8([new ot.Pa4(-10,-50,-50),new ot.Pa4(10,0,0),new ot.Pa4(8,50,50),new ot.Pa4(-5,0,100)]),i=n.getPoints(100);console.log("points",i);const o=new ot.u9r;o.vertices=i;const s=new ot.nls({color:4491519}),a=new ot.x12(o,s);this.app.scene.add(a);let r=[];for(let f=0;f<101;f++)r.push(f);var l=new Float32Array(r),c=[];i.forEach((t=>{c.push(t.x,t.y,t.z)}));var d=new Float32Array(c),u=new ot.tUh(".position",l,d);let p=101,m=new ot.m7l("default",p,[u]);this.mixer=new ot.Xcj(e);let h=this.mixer.clipAction(m);h.timeScale=20,h.play()}changeLookAt(t){var e=curve.getPointAt(t);mesh.position.copy(e);const n=curve.getTangentAt(t),i=n.add(e);mesh.lookAt(i)}}var Ae=Ce;class _e{constructor(){this.scene=new ot.xsS,this.factory=Qt,this.camera=null,this.render=null,this.clock=new ot.SUY,this.CSS2DRenderer=new ft.M,this.isLogin=0,this.dom=null,this.scId=null,this.productManager=new $t,this.mixerObject={},this.isFlyControls=!1,this.isScreen=!1,this.onLoad=!1}async init(t){this.dom=t||document.getElementById("div3d"),this.initSceneAndCamera(),this.initRender(),this.creatCSS2DRenderer(),this.initControls(),this.tunnel=new Me(this,(()=>{this.callFun(),this.animate(),this.updateOnWindowResize()})),this.scene.add(this.tunnel.group)}async loadScene(){await this.productManager.loadModels(),await this.productManager.loadMaterials(),this.productManager.setParkObj(this.productManager.getModelByName("demo").scene),this.factory.getCis(10010,(()=>{const t=this.scene.children.filter((t=>"Park"===t.type))[0];t&&t.position.setY(208),this.callFun(),this.animate()}))}initSceneAndCamera(){this.camera=new ot.cPb(45,this.dom.clientWidth/this.dom.clientHeight,1,5e6),this.camera.position.set(6706.452849809113,3466.627800031605,3438.7962564494514),this.camera.lookAt(this.scene.position),this.scene.add(this.camera)}callFun(){this.effect=new ae(this),this.eventInput=new zt(this),this.fly=new Ae(this),Et(this.dom.offsetWidth>1920),this.isScreen=(this.dom.offsetWidth,!1),this.onLoad=!0,this.fly.flyTo("default",(()=>{Ct()}))}initRender(){const t=document.createElement("canvas"),e=t.getContext("webgl2",{antialias:!0,alpha:!0});this.render=new ot.CP7({canvas:t,context:e}),this.render.gammaInput=!0,this.render.shadowMap.type=ot.ntZ,this.render.gammaOutput=!0,this.render.shadowMap.enabled=!0,this.render.setSize(this.dom.clientWidth,this.dom.clientHeight),this.composer=new te.xC(this.render);const n=new ee.C(this.scene,this.camera);this.composer.addPass(n),this.dom.appendChild(this.render.domElement)}creatCSS2DRenderer(){this.CSS2DRenderer.setSize(this.dom.clientWidth,this.dom.clientHeight),this.CSS2DRenderer.domElement.style.position="absolute",this.CSS2DRenderer.domElement.style.top="0",this.dom.appendChild(this.CSS2DRenderer.domElement)}createFlyControls(){this.flyControls=new Se.m(this.camera,this.render.domElement),this.flyControls.movementSpeed=35,this.flyControls.domElement=this.render.domElement,this.flyControls.rollSpeed=Math.PI/6,this.flyControls.autoForward=!1,this.flyControls.dragToLook=!1}initControls(){const t=new Ee.z(this.camera,this.CSS2DRenderer.domElement);t.target.set(0,.5,0),t.enableZoom=!0,t.enablePan=!0,t.maxDistance=2e4,this.render.controls=t}renderer3dUpdate(){this.mixer&&this.mixer.update(this.clock.getDelta()),this.tunnel&&this.tunnel.animate(this.clock.getDelta()),this.fly.animate(this.clock.getDelta()),this.CSS2DRenderer.render(this.scene,this.camera),this.composer.render()}setMixerObj(t,e){this.mixerObject[t]=e}getMixerObj(t){return this.mixerObject[t]}removeMixer(t){delete this.mixerObject[t]}updateMixer(t){for(let e in this.mixerObject)this.mixerObject[e].update(t)}animate(){window.META.renderer3dUpdate(),requestAnimationFrame(window.META.animate)}updateOnWindowResize(){window.addEventListener("resize",(()=>{this.updateDomResize()}),!0)}updateDomResize(){let t=window.innerWidth,e=window.innerHeight;this.dom.style.width=t+"px",this.dom.style.height=e+"px",this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.render.setSize(t,e)}}window.META=new _e,window.$=mt(),window.META=window.META||{},window.META.isMock=!0,window.META.creeate=qt,i["default"].use(s()),i["default"].config.productionTip=!1,new i["default"]({router:it,render:t=>t(u)}).$mount("#app")},9242:function(t,e,n){t.exports=n.p+"static/img/bottom.472fb2ba.png"},5155:function(t,e,n){t.exports=n.p+"static/img/leftTop.6bcf09e5.png"},9691:function(t,e,n){t.exports=n.p+"static/img/rightTip.fd4737dd.png"},7027:function(t,e,n){t.exports=n.p+"static/img/top.abb29963.png"}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,n),s.exports}n.m=t,function(){var t=[];n.O=function(e,i,o,s){if(!i){var a=1/0;for(d=0;d<t.length;d++){i=t[d][0],o=t[d][1],s=t[d][2];for(var r=!0,l=0;l<i.length;l++)(!1&s||a>=s)&&Object.keys(n.O).every((function(t){return n.O[t](i[l])}))?i.splice(l--,1):(r=!1,s<a&&(a=s));if(r){t.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[i,o,s]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,i){return n.f[i](t,e),e}),[]))}}(),function(){n.u=function(t){return"static/js/about.0cc62066.js"}}(),function(){n.miniCssF=function(t){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="channel:";n.l=function(i,o,s,a){if(t[i])t[i].push(o);else{var r,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==e+s){r=u;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,n.nc&&r.setAttribute("nonce",n.nc),r.setAttribute("data-webpack",e+s),r.src=i),t[i]=[o];var p=function(e,n){r.onerror=r.onload=null,clearTimeout(m);var o=t[i];if(delete t[i],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((function(t){return t(n)})),e)return e(n)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=p.bind(null,r.onerror),r.onload=p.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p=""}(),function(){var t={143:0};n.f.j=function(e,i){var o=n.o(t,e)?t[e]:void 0;if(0!==o)if(o)i.push(o[2]);else{var s=new Promise((function(n,i){o=t[e]=[n,i]}));i.push(o[2]=s);var a=n.p+n.u(e),r=new Error,l=function(i){if(n.o(t,e)&&(o=t[e],0!==o&&(t[e]=void 0),o)){var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;r.message="Loading chunk "+e+" failed.\n("+s+": "+a+")",r.name="ChunkLoadError",r.type=s,r.request=a,o[1](r)}};n.l(a,l,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,i){var o,s,a=i[0],r=i[1],l=i[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var d=l(n)}for(e&&e(i);c<a.length;c++)s=a[c],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return n.O(d)},i=self["webpackChunkchannel"]=self["webpackChunkchannel"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(7447)}));i=n.O(i)})();
//# sourceMappingURL=app.a82a9323.js.map
