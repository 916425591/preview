(function(){"use strict";var e={7447:function(e,t,n){n(6992),n(8674),n(9601),n(7727);var i=n(8935),o=n(3625),r=n.n(o),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],u=n(3736),c={},l=(0,u.Z)(c,a,s,!1,null,null,null),d=l.exports,f=(n(1539),n(8783),n(3948),n(2809)),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("Header"),n("BusinessWrap"),n("Layer"),n("PanelContent"),n("THREE"),e.onLoad?n("Loading",{attrs:{loadingTime:e.time}}):e._e()],1)},m=[],v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"core",style:{width:e.width+"px",height:e.height+"px"},attrs:{id:"div3d"}})},h=[],y={name:"ThreeLoad",props:{msg:String},data:function(){return{width:null,height:null}},methods:{init:function(){this.$nextTick((function(){META.init()}))}},mounted:function(){this.width=this.$el.offsetWidth,this.height=this.$el.parentElement.offsetHeight,this.init()}},g=y,w=(0,u.Z)(g,v,h,!1,null,"7ffd81cb",null),x=w.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loading"},[n("div",{staticClass:"gress"},[n("div",{staticClass:"sys-loading-name",staticStyle:{"justify-content":"center"}},[e._v(" 坪盐隧道 ")]),n("Progress",{attrs:{percent:e.loadingTime,"hide-info":""}}),n("div",{staticClass:"sys-loading-description",staticStyle:{"justify-content":"center"}},[n("span",{staticClass:"log"},[e._v("正在加载")]),e._v(e._s(e.loadingTime)+"% ")])],1)])},T=[],M=(n(9653),{name:"LoadingPercent",props:{loadingTime:Number},data:function(){return{time:null}},methods:{},mounted:function(){}}),E=M,S=(0,u.Z)(E,b,T,!1,null,"c1c0fb8e",null),k=S.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"header"},[n("img",{attrs:{src:e.imgBg}})])},C=[],A={name:"HeaderTop",data:function(){return{imgBg:"".concat(n(7027))}}},_=A,z=(0,u.Z)(_,P,C,!1,null,"e3c39b56",null),j=z.exports,O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"business",style:{top:e.top}},[n("img",{attrs:{src:e.imgBg}})])},I=[],L={name:"BusinessWrap",data:function(){return{top:window.innerWidth>1920?"28%":"36%",imgBg:"".concat(n(5155))}}},R=L,Z=(0,u.Z)(R,O,I,!1,null,"3e19e3c2",null),F=Z.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"panel",style:{top:e.top}},[n("img",{attrs:{src:e.imgBg}})])},B=[],N={name:"PanelContent",data:function(){return{top:window.innerWidth>1920?"21%":"30%",imgBg:"".concat(n(9691))}}},W=N,H=(0,u.Z)(W,D,B,!1,null,"71bd5581",null),K=H.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"layer"},[n("img",{attrs:{src:e.imgBg}})])},Y=[],U={name:"LayerContent",data:function(){return{imgBg:"".concat(n(9242))}}},$=U,J=(0,u.Z)($,G,Y,!1,null,"f0bf5b3a",null),X=J.exports,q={name:"HomeView",components:{THREE:x,Loading:k,Header:j,BusinessWrap:F,PanelContent:K,Layer:X},data:function(){return{time:0,interval:null,onLoad:!0}},methods:{load:function(){var e=this;this.interval=setInterval((function(){window.META.onLoad?(e.time=100,e.onLoad=!1,clearInterval(e.interval)):e.time>90?e.time=95:e.time+=5}),20)}},mounted:function(){this.load()}},V=q,Q=(0,u.Z)(V,p,m,!1,null,"2f1ddec6",null),ee=Q.exports;i["default"].use(f.Z);var te=[{path:"/",name:"home",component:ee},{path:"/about",name:"about",component:function(){return n.e(443).then(n.bind(n,4613))}}],ne=new f.Z({base:"",routes:te}),ie=ne,oe=(n(8309),n(3226)),re=n(5200),ae=(n(4916),n(3123),n(561),function(e,t){return toString.call(e)==="[object "+t+"]"}),se=function(e,t){var n=(0,re.Z)(e,2),i=n[0],o=n[1],r=(0,re.Z)(t,2),a=r[0],s=r[1];return[(i+a)/2,(o+s)/2]},ue=function(e,t,n,i){var o=Math.atan2(n-i,e-t);return 180/Math.PI*o},ce=function(e,t,n,i){return Math.sqrt((e-t)*(e-t)+(n-i)*(n-i))},le=function e(t,n){if(t){if(t.isVector3)return t;if(Array.isArray(t))return 1===t.length?new oe.Pa4(parseFloat(t[0]),0,0):2===t.length?new oe.Pa4(parseFloat(t[0]),0,parseFloat(t[1])):new oe.Pa4(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));if(ae(t,"String")){for(var i=t.split(/,| /),o=0;o<i.length;o++){var r=i[o].trimBoth("\\[\\]");r.isBlank()?i.splice(o--,1):i[o]=Number(r)}return e(i,n)}}return n},de=new oe.Pa4,fe=new oe.ZzF;oe.Tme.prototype.selfToWorld=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e=le(e),this.node.updateMatrixWorld(),t){var n=new oe.Pa4,i=new oe.Pa4,o=new oe._fP;this.node.matrixWorld.decompose(n,o,i);var r=new oe.yGw;return r.compose(n,o,new oe.Pa4(1,1,1)),e.applyMatrix4(r).toArray()}return this.node.localToWorld(e).toArray()},oe.Tme.prototype.getWorldAABB=function(){var e=this.getFromObjAabb(),t=e.getSize(de),n=t.x,i=t.y,o=t.z;return{width:n,height:i,depth:o}},oe.Tme.prototype.getCenter=function(){var e=this.getFromObjAabb(),t=e.center(de);return t},oe.Tme.prototype.getFromObjAabb=function(){var e=fe.setFromObject(this);return e},oe.Tme.prototype.setPickEnabled=function(e){this.pickEnabled=e},oe.Tme.prototype.getPickEnabled=function(){return void 0===this.pickEnabled||this.pickEnabled},oe.Tme.prototype.convertWorldToLocalPosition=function(e){var t;t=e.isVector3?e.clone():new oe.Pa4(e[0],e[1],e[2]);var n=this.worldToLocal(t);return[n.x,n.y,n.z]},oe.Tme.prototype.convertLocalToWorldPosition=function(e){var t;t=e.isVector3?e.clone():new oe.Pa4(e[0],e[1],e[2]),t=new oe.Pa4(e[0],e[1],e[2]);var n=this.localToWorld(t);return[n.x,n.y,n.z]},oe.Tme.prototype.setLocalPostion=function(e){var t=this.parent.position,n=t.x,i=t.z,o=new oe.Pa4(n+e[0],e[1],i+e[2]);this.position.set(o.x,o.y,o.z)},oe.Tme.prototype.destroy=function(){var e=this;this.traverse((function(t){"Mesh"===t.type&&(t.geometry.dispose(),t.material.dispose()),e.remove(t)})),this.parent.remove(this)},oe.Tme.prototype.setOpacity=function(e){this.material&&(this.material.opacity=e)},oe.Tme.prototype.destroyChildByName=function(e){var t=this;this.traverse((function(n){n.name===e&&(n instanceof oe.Kj0&&(n.geometry.dispose(),n.material.dispose()),t.remove(n))}))};var pe=n(4029),me=n.n(pe),ve=n(6198),he=n(6133),ye=n(2751),ge=(n(7327),n(8975),n(4747),n(796)),we=n(7237),xe=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n);var o=e._POINTS_,r=e._RADIUS_,a=[];JSON.parse(o).forEach((function(e){a.push(new oe.Pa4(e[0],e[1],e[2]))}));var s=new oe.YT8(a),u=new oe.WXh(s,300,r||1,20,!1),c=new oe.Wid({color:65295,side:oe.ehD,transparent:!0});return i=t.call(this,u,c),i.type="Lines",i}return(0,ye.Z)(n)}(oe.Kj0),be=(n(3290),n(2222),n(3971));function Te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,r=o.title,a=o.content,s=document.createElement("div"),u=META.dom.offsetWidth,c=META,l=c.isScreen,d=l?"120":.08*u,f=.23*d*.021;s.style.width=d+"px",s.style.height=l?"84px":.6*d+"px",s.style.padding=l?"3px 10px 25px 10px":"".concat(f,"px ").concat(3*f,"px ").concat(f,"px ").concat(10*f,"px"),s.style.color="#fff",s.style.background="url(".concat(window.baseImage,"tip/orangeTip.png) no-repeat"),s.style.backgroundSize="100% 100%",s.style.fontSize=.23*d*.45+"px",s.style.position="absolute",s.style.zIndex=1;var p=new be.j(s);p.position.x=e,p.position.y=t+1,p.position.z=n,p.name=i,s.style.pointerEvents="none";var m="\n        <div>".concat(r,'</div>\n        <div style="margin-top: 10px;">').concat(a,"</div>\n    ");return s.innerHTML=m,p.visible=!0,p}function Me(e,t,n,i,o){var r=o.speed,a=o.traffic,s=document.createElement("div"),u=META.dom.offsetWidth,c=META,l=c.isScreen,d=l?120:.08*u,f=.23*d*.021;s.style.width=d+"px",s.style.height=l?"84px":.6*d+"px",s.style.padding=l?"17px 10px 10px 10px":"".concat(f,"px ").concat(3*f,"px ").concat(f,"px ").concat(10*f,"px"),s.style.color="#fff",s.style.background="url(".concat(window.baseImage,"tip/greenTip.png) no-repeat"),s.style.backgroundSize="100% 100%",s.style.fontSize=.23*d*.45+"px",s.style.position="absolute",s.style.zIndex=1;var p=new be.j(s);p.name=i,p.position.x=e,p.position.y=t+1,p.position.z=n,s.style.pointerEvents="none";var m="\n       <div>平均车速：".concat(r,"KM</div>\n       <div>车流量：").concat(a,"辆</div>\n    ");return s.innerHTML=m,p.visible=!0,p}function Ee(e,t,n,i,o){var r=o.title,a=o.content,s=document.createElement("div"),u=META.dom.offsetWidth,c=META,l=c.isScreen,d=.15*u,f=.23*d*.4,p=.2*d,m=.23*d*.061,v=.23*d*.021;s.style.width=.74*d+"px",s.style.height=.23*d+"px",s.style.padding="".concat(m,"px 0px ").concat(v,"px ").concat(p,"px"),s.style.color="#fff",s.style.background="url(".concat(window.baseImage,"tip/geomagnetism.png) no-repeat"),s.style.backgroundSize="100% 100%",s.style.fontSize=.23*d*.2+"px",s.style.position="absolute",s.style.zIndex=1;var h=new be.j(s);h.name=i,h.position.x=e,h.position.y=t+1,h.position.z=n,s.style.pointerEvents="none";var y="\n        <div>".concat(r,'</div>\n        <div><img style="width: ').concat(f,"px;\n        margin-top: ").concat(l?"15px":"0px",";\n        margin-right:").concat(l?"18px":"0px",' ;\n        float: left;" \n        src=').concat(window.baseUrl,"'/image/tip/alarmiIcon.png'> <span style=\"margin-top:").concat(l?"31px":"0px",";\n        float: left;font-size:").concat(.5*f,'px">').concat(a,"</span></div>\n    ");return s.innerHTML=y,h.visible=!0,h}function Se(e,t,n,i,o){var r=o.title,a=o.content,s=document.createElement("div"),u=META,c=u.isScreen,l=META.dom.offsetWidth,d=.15*l,f=.23*d*.4,p=.23*d,m=.23*d*.1,v=.23*d*.061,h=.23*d*.021;s.style.width=.74*d+"px",s.style.height=.23*d+"px",s.style.padding="".concat(v,"px ").concat(p,"px ").concat(h,"px ").concat(m,"px"),s.style.color="#fff",s.style.background="url(".concat(window.baseImage,"tip/congestionTip.png) no-repeat"),s.style.backgroundSize="100% 100%",s.style.fontSize=.23*d*.2+"px",s.style.position="absolute",s.style.zIndex=1;var y=new be.j(s);y.name=i,y.position.x=e,y.position.y=t+1,y.position.z=n,s.style.pointerEvents="none";var g="\n        <div>".concat(r,'</div>\n        <div><img style="width: ').concat(f,"px;\n        margin-top: ").concat(c?"35px":"5px",";\n        margin-right: ").concat(c?"18px":"5px",' ;\n        float: left;" \n        src=').concat(window.baseUrl,"'/image/tip/alarmiIcon.png'> <span style=\"margin-top: ").concat(c?"41px":"5px",";\n        float: left;font-size:").concat(.5*f,'px">').concat(a,"</span></div>\n    ");return s.innerHTML=g,y.visible=!0,y}function ke(e,t,n,i,o){var r=o.title,a=o.content,s=document.createElement("div"),u=META,c=u.isScreen,l=META.dom.offsetWidth,d=.15*l,f=.23*d*.4,p=.2*d,m=.23*d*.061,v=.23*d*.31;s.style.width=.74*d+"px",s.style.padding="".concat(m,"px ").concat(m,"px ").concat(v,"px ").concat(p,"px"),s.style.color="#fff",s.style.background="url(".concat(window.baseImage,"tip/geomagnetism.png) no-repeat"),s.style.backgroundSize="100% 100%",s.style.fontSize="10px",s.style.position="absolute",s.style.zIndex=1;var h=new be.j(s);h.name=i,h.position.x=e,h.position.y=t+1,h.position.z=n,s.style.pointerEvents="none";var y="\n        <div>".concat(r,'</div>\n        <div><img style="width: ').concat(f,"px;\n        margin-top:").concat(c?"35px":"5px",";\n        margin-right: ").concat(c?"18px":"0px",';\n        float: left;" \n        src=').concat(window.baseUrl,"'/image/tip/alarmiIcon.png'> <span style=\"margin-top: ").concat(c?"41px":"5px",";\n        float: left;font-size:").concat(.5*f,'px">').concat(a,'</span></div>\n        \n        \n        </div>\n        <div><img style="    width: 100%;\n        margin-top: ').concat(c?"11px":"5px",";\n        margin-right: ").concat(c?"3px":"0px",';\n        float: left;" \n        src=').concat(window.baseUrl,"'/image/tip/carAlarm.png'></div>\n    ");return s.innerHTML=y,h.visible=!0,h}var Pe=[],Ce=[],Ae=["对象019","对象021"];function _e(e){Pe=[{type:"magnetic",x:e?-47:-50,y:100,z:-932,data:{title:"#RUF1232",content:"地磁车检器离线"}},{type:"car",x:e?-34:-45,y:100,z:e?-850:-902,data:{speed:"64",traffic:"1325"}},{type:"car",x:e?-60:-54,y:100,z:e?-1012:-962,data:{speed:"63",traffic:"1325"}},{type:"car",x:e?-31:-35,y:100,z:e?-917:-925,data:{speed:"65",traffic:"123"}},{type:"car",x:e?-18:-31,y:100,z:e?-827:-895,data:{speed:"89",traffic:"1326"}},{type:"car",x:e?-42:-40,y:100,z:e?-1e3:-955,data:{speed:"65",traffic:"1327"}}],Ce=[{type:"geomagneticCity",x:e?650:270,y:300,z:e?-2532:-1900,data:{title:"#ZK03+40 ZCJ01",content:"地磁车检器离线"}},{type:"jamAlarm",x:e?0:250,y:-250,z:e?0:-232,data:{title:"#ZK3+40",content:"拥堵报警"}},{type:"carAccident",x:e?0:-501,y:e?-470:-250,z:e?3532:2732,data:{title:"#ZK3+40",content:"追车辆尾报警"}}]}function ze(){var e=window.META;Pe.forEach((function(t,n){var i=t.x,o=t.y,r=t.z,a=t.data;"car"===t.type?e.scene.add(Me(i,o,r,t.type+n+"default",a)):e.scene.add(Te(i,o,r,t.type+n+"default",a))})),Ae.forEach((function(t){var n=e.scene.getObjectByName(t);n.visible=!1}))}function je(){var e=window.META;Pe.forEach((function(t,n){var i=t.type+n+"default",o=e.scene.getObjectByName(i);e.scene.remove(o)})),Ae.forEach((function(t){var n=e.scene.getObjectByName(t);n.visible=!0}))}function Oe(){var e=window.META.scene.getObjectByName("对象001");Ce.forEach((function(t,n){var i=t.x,o=t.y,r=t.z,a=t.data;"geomagneticCity"===t.type?e.add(Ee(i,o,r,t.type+n+"default",a)):"jamAlarm"===t.type?e.add(Se(i,o,r,t.type+n+"default",a)):"carAccident"===t.type&&e.add(ke(i,o,r,t.type+n+"default",a))}))}function Ie(){var e=window.META,t=e.scene.getObjectByName("对象001");Ce.forEach((function(n,i){var o=n.type+i+"default",r=e.scene.getObjectByName(o);t.remove(r)}))}window.tunnelDefault=ze;var Le=function(){function e(t){(0,he.Z)(this,e),this.app=t,this.mouse=new oe.FM8,this.raycaster=new oe.iMs,this.scene=this.app.scene.getObjectByName("pyScene")||this.app.scene,this.selectedObject=[],this.rootObj=null,this.count=0,this.timer=null,this.flyEnd=!0,this.init()}return(0,ye.Z)(e,[{key:"init",value:function(){this.app.dom.addEventListener("click",this.addOnClick),this.app.dom.addEventListener("dblclick",this.onLeftDbClick),this.app.dom.oncontextmenu=this.rightDbCLick}},{key:"getRootObj",value:function(){return META.eventInput.rootObj}},{key:"addOnClick",value:function(e){e.preventDefault(),META.eventInput.mouse.x=e.clientX/window.innerWidth*2-1,META.eventInput.mouse.y=-e.clientY/window.innerHeight*2+1,META.eventInput.raycaster.setFromCamera(META.eventInput.mouse,META.camera);var t=META.eventInput.getPickObj(META.eventInput.raycaster.intersectObject(META.eventInput.scene,!0));t?(META.outLinePass.selectedObjects=[],META.eventInput.rootObj=t):(META.outLinePass.selectedObjects=[],META.eventInput.rootObj=null)}},{key:"onLeftDbClick",value:function(e){e.preventDefault(),META.eventInput.mouse.x=e.clientX/window.innerWidth*2-1,META.eventInput.mouse.y=-e.clientY/window.innerHeight*2+1,META.eventInput.raycaster.setFromCamera(META.eventInput.mouse,META.camera);var t=META.eventInput.getPickObj(META.eventInput.raycaster.intersectObject(META.eventInput.scene,!0));t&&META.eventInput.flyEnd&&(Ie(),META.eventInput.flyEnd=!1,META.fly.flyTo(t,(function(){t instanceof xe&&(META.isFlyControls=!0),META.eventInput.flyEnd=!0,ze()})))}},{key:"rightDbCLick",value:function(e){META.eventInput.flyEnd&&(META.eventInput.count+=1,META.eventInput.timer=setTimeout((function(){clearTimeout(META.eventInput.timer),META.eventInput.count>1&&(META.eventInput.count=0,META.eventInput.flyEnd=!1,je(),META.fly.flyTo("default",(function(){META.isFlyControls=!1,META.eventInput.flyEnd=!0,Oe()}))),META.eventInput.count=0}),200))}},{key:"onPointerMove",value:function(e){META.eventInput.mouse.x=e.clientX/window.innerWidth*2-1,META.eventInput.mouse.y=-e.clientY/window.innerHeight*2+1,META.eventInput.raycaster.setFromCamera(META.eventInput.mouse,META.camera);var t=eventLists.getPickObj(META.eventInput.raycaster.intersectObject(META.scene,!0));META.outLinePass.selectedObjects=t||[]}},{key:"getPickObj",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=null;return e.forEach((function(e){var n=e.object;n&&!n.getPickEnabled()||(t=n)})),t}}]),e}(),Re=Le,Ze=(n(1249),n(6903)),Fe=function(){return new Promise((function(e){var t=[{id:"demo",url:"/models/demo/demo0528.gltf",name:"demo"}];e(t)}))},De=function(){return new Promise((function(e){var t=[{id:"20010",url:"/material/grid/hardwood2_bump.jpg",name:"hardwood2_bump"},{id:"20011",url:"/material/grid/hardwood2_diffuse.jpg",name:"hardwood2_diffuse"},{id:"20012",url:"/material/grid/hardwood2_roughness.jpg",name:"hardwood2_roughness"},{id:"20013",url:"/material/test.jpg",name:"test"},{id:"20017",url:"/textures/grasslight-big.jpg",name:"grasslight"}];e(t)}))},Be=new Ze.E,Ne=new oe.dpR,We=function(){function e(){(0,he.Z)(this,e),this.productModelLists=[],this.productMaterialsList=[],this.productModelObjs={},this.materialsObjs={},this.parkObj=null}return(0,ye.Z)(e,[{key:"loadModels",value:function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,Fe();case 3:return this.productModelLists=e.sent,e.next=6,Promise.all(t.productModelLists.map(function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.loadModel(n.url);case 2:i=e.sent,t.productModelObjs[n.name]=i;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setParkObj",value:function(e){this.parkObj=e}},{key:"getParkChildNams",value:function(e){return this.parkObj.getChildByName(e)}},{key:"loadModel",value:function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){Be.load(t,(function(t){e(t)}))})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadMaterials",value:function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,De();case 3:return this.productMaterialsList=e.sent,e.next=6,Promise.all(t.productMaterialsList.map(function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.loadMaterial(n.url);case 2:i=e.sent,t.materialsObjs[n.name]=i;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadMaterial",value:function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=Ne.load(t);e(n)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getMaterialByName",value:function(e){return this.materialsObjs[e]}},{key:"getModelByName",value:function(e){return this.productModelObjs[e]}},{key:"getProduct",value:function(){}}]),e}(),He=n(6166),Ke=n.n(He);function Ge(){return"TOKEN-XXX"}var Ye=Ke().create({baseURL:"",timeout:5e3});function Ue(e,t){Ye({url:e,method:"post",params:t})}Ye.interceptors.request.use((function(e){var t=Ge();return t&&(e.headers["X-Token"]=t),e}),(function(e){return Promise.reject(e)})),Ye.interceptors.response.use((function(e){var t=e;return 200!==t.status?(o.Message.error(t.message||"接口异常"),Promise.reject(t.message||"接口异常")):t.data}));var $e=function(e){return META.isMock?new Promise((function(t){me().getJSON("/mocks/getCi_".concat(e,".json"),(function(e){t(e)}))})):Ue("/query/ci",{id:e})},Je=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n),i=t.call(this,e),i.type="Device",i.actions={};var o=e._PRODUCT_,r=e._OFFSET_,a=e._STYLE_,s=e._NAME_,u=e._ISPICK_,c=META.productManager.getParkChildNams(o);if(c){if(i.animations=c.animations,i.isAnimations()&&i.creatAnimations(c.scene,c.animations),i.lastActiveAction=null,a)for(var l in a)c.material[l]=a[l];if(i.copy(c.material),i.name=s,i.setPickEnabled(void 0===u||u),r){var d=JSON.parse(r);i.position.set(d[0],d[1],d[2])}}return i}return(0,ye.Z)(n,[{key:"init",value:function(){}},{key:"isAnimations",value:function(){return this.animations.length>0}},{key:"creatAnimations",value:function(e,t){for(var n=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],i=["Jump","Yes","No","Wave","Punch","ThumbsUp"],o=new oe.Xcj(e),r=0;r<t.length;r++){var a=t[r],s=o.clipAction(a);this.actions[a.name]=s,(i.indexOf(a.name)>=0||n.indexOf(a.name)>=4)&&(s.clampWhenFinished=!0,s.loop=oe.jAl)}this.fadeToAction()}},{key:"fadeToAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Walking",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=this;this.actions[e]&&(this.lastActiveAction?(this.lastActiveAction.fadeOut(t),this.actions[e].reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(t).play(),this.lastActiveAction=this.actions[e]):setInterval((function(){n.actions[e].play()}),300))}}]),n}(oe.Tme),Xe=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n);var o=e.start,r=e.end,a=e.height,s=e.depth,u=e.PARENTWIDTH,c=e.PARENTDEPAT,l=ce(o[0],r[0],o[1],r[1]),d=ue(o[0],r[0],o[1],r[1]),f=new oe.bnF;for(var p in f.moveTo(-s,-0),f.lineTo(-s,a),f.lineTo(l,a),f.lineTo(l,-0),f.lineTo(-s,-0),e._CHILDREN_){var m=e._CHILDREN_[p],v=m._PRODUCT_,h=m._LOCATION_,y=META.productManager.getModelByName(v).scene,g=y&&y.getWorldAABB(),w=g.width,x=g.height,b=n.setDoorPosit(Number(h),w,x);f.holes.push(b)}var T={depth:s,bevelEnabled:!1,bevelThickness:1,bevelSize:0,bevelSegments:1},M=new oe.O7d(f,T);i=t.call(this,M,new oe.xoR({color:16777215,roughness:.5,side:oe.ehD,transparent:!0,opacity:.5,metalness:.5})),M.center();var E=se(o,r);return 0!==d&&180!==d&&(i.rotation.y=d/180*Math.PI),i.opacity=.5,i.position.set(E[0]-u/2,a/2,E[1]+c/2-4),i.type="Wall",i}return(0,ye.Z)(n,null,[{key:"setDoorPosit",value:function(e,t,n){var i=new oe.y$t,o=e-t/2,r=e+t/2;return i.moveTo(o,0),i.lineTo(o,n),i.lineTo(r,n),i.lineTo(r,0),i.lineTo(o,0),i}}]),n}(oe.Kj0),qe=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n);var o=new oe.Wid({side:oe.Wl3,color:16777215*Math.random()}),r=e.WIDTH,a=void 0===r?100:r,s=e.HEIGHT,u=void 0===s?200:s,c=e.DEPAT,l=void 0===c?100:c,d=e._OFFSET_,f=new oe.nvb(a,u,l);if(i=t.call(this,f,o),i.type="Box",d){var p=JSON.parse(d);i.position.set(p[0],u/2,p[2])}return i.castShadow=!0,i.receiveShadow=!0,i}return(0,ye.Z)(n)}(oe.Kj0),Ve=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n),i=t.call(this,e),i.type="Park",i.actions={};var o=e._PRODUCT_,r=e._OFFSET_;if(o.length>0){var a=META.productManager.getParkChildNams(o)||META.productManager.getModelByName(o).scene;if(i.animations=a.animations,i.lastActiveAction=null,i.copy(a),a.remove(),r){var s=JSON.parse(r);i.position.set(s[0],s[1],s[2])}}return i}return(0,ye.Z)(n,[{key:"init",value:function(){}}]),n}(oe.Tme),Qe=n(3263),et=n(3796),tt=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n);var o=[{pos:[40*Math.random()-20,40*Math.random()-20,40*Math.random()-20],rotations:[0,0,0],scales:[1,1,1]}],r=new oe.DvJ(1,1,1),a=new oe.Wid({color:2200782,roughness:.5,metalness:0});i=t.call(this,r,a,o.length),(0,et.Z)((0,Qe.Z)(i),"randomizeMatrix",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=new oe.Pa4,i=new oe.USm,o=new oe._fP,r=new oe.Pa4;return function(a){n.x=40*Math.random()-20,n.y=40*Math.random()-20,n.z=40*Math.random()-20,i.x=e[0],i.y=e[1],i.z=e[2],o.setFromEuler(i),r.x=t[0],r.y=t[1],r.z=t[2],a.compose(n,o,r)}}()),i.type="instancedEx",i.makeInstanced();var s=JSON.parse(e._OFFSET_);return i.position.set(s[0],s[1]+10,s[2]),i.type="Instanced",i}return(0,ye.Z)(n,[{key:"makeInstanced",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,n=new oe.yGw;e.forEach((function(e,i){t.randomizeMatrix(e.pos,e.rotations,e.scales),t.setMatrixAt(i,n)}))}},{key:"getInstancedId",value:function(){}}]),n}(oe.SPe),nt=function(e){(0,ge.Z)(n,e);var t=(0,we.Z)(n);function n(e){var i;(0,he.Z)(this,n),i=t.call(this,e),i.type="GroupEx";var o=e._OFFSET_;if(o){var r=JSON.parse(o);i.position.set(r[0],r[1],r[2])}return i}return(0,ye.Z)(n)}(oe.ZAu),it=function(){};it.objTypes={Walls:Xe,Device:Je,Box:qe,Lines:xe,InstancedEx:tt,Park:Ve,Group:nt},it.setType=function(e,t){it.objTypes[e]=t},it.getObjTypes=function(e){return it.objTypes[e]},it.create=function(e){var t=new it.objTypes[e.type](e.param);return t.userData=e.param,e.complete&&(e.complete(t),delete e.complete),t};var ot=it,rt=function(){};rt.objs={},rt.createObject=function(e){var t=e._PARENTDBID_,n=e._ID_,i=e._TYPE_,o=ot.create({type:i,complete:function(){},param:e});n&&(rt.objs[n]=o);var r=rt.objs[t];r?r.add(o):META.scene.add(o),o.init&&o.init()},rt.getObjectByDbid=function(e){return rt.objs[e]},rt.getCis=function(e,t){$e(e).then(function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=100/n.length,i>0&&(i=parseInt(i)),rt.recursiveObj(n,i),t&&t();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},rt.recursiveObj=function(e,t){for(var n in e){var i=e[n];i._TYPE_&&rt.createObject(i),(i._TYPE_||i._CHILDREN_)&&i._CHILDREN_&&rt.recursiveObj(i._CHILDREN_,t)}};var at=rt,st=n(6876),ut=n(8595),ct=(n(2481),n(1740)),lt=n(8227),dt=n(8721),ft={exposure:1.2,bloomStrength:.1,bloomThreshold:.6,bloomRadius:.6},pt=function(){function e(t){(0,he.Z)(this,e),this.app=t,this.pass=new dt.C,this.outLinePass=new ct.f(new oe.FM8(t.dom.offsetWidth,t.dom.offsetHeight),t.scene,t.camera),this.bloomPass=new lt.m(new oe.FM8(t.dom.offsetWidth,t.dom.offsetHeight),1.5,.4,.85),this.initOutLine(),this.addPointLight(),this.addBackgroundImg(window.baseImage+"curtain.png")}return(0,ye.Z)(e,[{key:"addHemiLight",value:function(){var e=new oe.Ox3(16777215,1);e.color.setHSL(.1,1,.95),e.position.set(-1,1.75,1),e.position.multiplyScalar(30),this.app.scene.add(e),e.castShadow=!0}},{key:"setFloor",value:function(e){Utils.forMaterial(e.material,(function(e){e.color.setStyle("#040912")}))}},{key:"addRrdinaryGrid",value:function(){var e=(new oe.dpR).load("/textures/hardwood2_bump.jpg"),t=new oe._12(1e4,1e4),n=new oe.xoR({color:8421504,map:e}),i=new oe.Kj0(t,n);i.rotation.x=-Math.PI/2,i.material.map.repeat.set(8,8),i.material.map.wrapS=i.material.map.wrapT=oe.rpg,i.material.map.encoding=oe.knz,i.receiveShadow=!0,this.app.scene.add(i)}},{key:"addPointLight",value:function(){var e=new oe.xo$(0,16,8),t=new oe.cek(16777215,2,0,2),n=new oe.Wid({emissive:16777198,emissiveIntensity:1,color:0});t.add(new oe.Kj0(e,n)),t.position.set(3006.452849809113,3466.627800031605,38.7962564494514),t.castShadow=!0,this.app.scene.add(t);var i=new oe.vmT(16777215,16777215,.8);this.app.scene.add(i)}},{key:"addFog",value:function(){this.app.scene.fog=new oe.ybr(16777215,100,16e4)}},{key:"addSkyBoxCubemap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/effectBox/skyboxPolar",t=new oe.cBK,n=t.load([e+"/Sky_Space_Right.jpg",e+"/Sky_Space_Left.jpg",e+"/Sky_Space_Up.jpg",e+"/Sky_Space_Down.jpg",e+"/Sky_Space_Back.jpg",e+"/Sky_Space_Front.jpg"]);this.app.scene.background=n}},{key:"addPlaneGrid",value:function(){var e=new oe.BKK(1e4,1e4),t=new oe.xoR,n=new oe.Kj0(e,t);n.name="grid",n.material.color.setStyle("#f8f8f8"),n.rotation.x=-Math.PI/2,n.receiveShadow=!0,this.app.scene.add(n)}},{key:"addCircleGrid",value:function(){var e=new oe.zf8(5e3,60),t=new oe.vBJ({color:16776960}),n=new oe.Kj0(e,t);n.rotation.x=-Math.PI/2,n.receiveShadow=!0,this.app.scene.add(n)}},{key:"addBackground",value:function(e){this.app.scene.background=new oe.Ilk(e||"#0e1829")}},{key:"addBackgroundImg",value:function(e){var t=new oe.dpR,n=t.load(e);this.app.scene.background=n}},{key:"initOutLine",value:function(){this.outLinePass.edgeStrength=Number(10),this.outLinePass.edgeGlow=Number(.5),this.outLinePass.edgeThickness=Number(2.5),this.outLinePass.pulsePeriod=Number(2.5),this.outLinePass.visibleEdgeColor.set("#ed8e00"),this.app.composer.addPass(this.outLinePass),this.app.outLinePass=this.outLinePass}},{key:"initBoom",value:function(){this.bloomPass.threshold=ft.bloomThreshold,this.bloomPass.strength=ft.bloomStrength,this.bloomPass.radius=ft.bloomRadius,this.app.composer.addPass(this.bloomPass)}},{key:"effectGlitchPass",value:function(){this.pass.renderToScreen=!0,this.app.composer.addPass(this.pass)}}]),e}(),mt=(n(5306),{surroundLineGeometry:function(e){return new oe.TOt(e.geometry)}}),vt="\nprecision mediump float;\n\nfloat distanceTo(vec2 src, vec2 dst) {\n    float dx = src.x - dst.x;\n    float dy = src.y - dst.y;\n    float dv = dx * dx + dy * dy;\n    return sqrt(dv);\n} \n\nfloat lerp(float x, float y, float t) {\n    return (1.0 - t) * x + t * y;\n}\n\n#define PI 3.14159265359\n#define PI2 6.28318530718\n\n",ht={vertexShader:"\n    #define PI 3.14159265359\n\n    uniform mediump float uStartTime;\n    uniform mediump float time;\n    uniform mediump float uRange;\n    uniform mediump float uSpeed;\n\n    uniform vec3 uColor;\n    uniform vec3 uActive;\n    uniform vec3 uMin;\n    uniform vec3 uMax;\n\n    varying vec3 vColor;\n\n    float lerp(float x, float y, float t) {\n        return (1.0 - t) * x + t * y;\n    }\n    void main() { \n        if (uStartTime >= 0.99) {\n            float iTime = mod(time * uSpeed - uStartTime, 1.0);\n            float rangeY = lerp(uMin.y, uMax.y, iTime);\n            if (rangeY < position.y && rangeY > position.y - uRange) {\n                float index = 1.0 - sin((position.y - rangeY) / uRange * PI);\n                float r = lerp(uActive.r, uColor.r, index);\n                float g = lerp(uActive.g, uColor.g, index);\n                float b = lerp(uActive.b, uColor.b, index);\n\n                vColor = vec3(r, g, b);\n            } else {\n                vColor = uColor;\n            }\n        }\n        vec3 vPosition = vec3(position.x, position.y, position.z * uStartTime);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n    } \n    ",fragmentShader:" \n    ".concat(vt," \n    uniform float time;\n    uniform float uOpacity;\n    uniform float uStartTime;\n\n    varying vec3 vColor; \n\n    void main() {\n\n        gl_FragColor = vec4(vColor, uOpacity * uStartTime);\n    }\n    ")},yt={base:vt,surroundLine:ht},gt={forMaterial:function(e,t){if(!t||!e)return!1;Array.isArray(e)?e.forEach((function(e){t(e)})):t(e)}},wt="\nprecision mediump float;\n \nfloat atan2(float y, float x){\n  float t0, t1, t2, t3, t4;\n  t3 = abs(x);\n  t1 = abs(y);\n  t0 = max(t3, t1);\n  t1 = min(t3, t1);\n  t3 = float(1) / t0;\n  t3 = t1 * t3;\n  t4 = t3 * t3;\n  t0 = -float(0.013480470);\n  t0 = t0 * t4 + float(0.057477314);\n  t0 = t0 * t4 - float(0.121239071);\n  t0 = t0 * t4 + float(0.195635925);\n  t0 = t0 * t4 - float(0.332994597);\n  t0 = t0 * t4 + float(0.999995630);\n  t3 = t0 * t3;\n  t3 = (abs(y) > abs(x)) ? float(1.570796327) - t3 : t3;\n  t3 = (x < 0.0) ?  float(3.141592654) - t3 : t3;\n  t3 = (y < 0.0) ? -t3 : t3;\n  return t3;\n}\n// 计算距离\nfloat distanceTo(vec2 src, vec2 dst) {\n\tfloat dx = src.x - dst.x;\n\tfloat dy = src.y - dst.y;\n\tfloat dv = dx * dx + dy * dy;\n\treturn sqrt(dv);\n}\n\n#define PI 3.14159265359\n#define PI2 6.28318530718\n\nuniform vec3 u_color;\nuniform float time;\nuniform float u_opacity;\nuniform float u_radius;\nuniform float u_width;\nuniform float u_speed;\n\nvarying vec2 v_position;\n\n    ",xt={vertexShader:"\n    varying vec2 v_position;\n    \n    void main() {\n        v_position = vec2(position.x, position.y);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }",fragmentShader:"\n    ".concat(wt," \n    void main() {\n        float d_time = u_speed * time;\n\n        float angle = atan2(v_position.x, v_position.y) + PI;\n        \n        float angleT = mod(angle + d_time, PI2);\n\n        float width = u_width;\n    \n        float d_opacity = 0.0;\n\n        // 当前位置离中心位置\n        float length = distanceTo(vec2(0.0, 0.0), v_position);\n        \n        float bw = 5.0;\n        if (length < u_radius && length > u_radius - bw) {\n            float o = (length - (u_radius - bw)) / bw;\n            d_opacity = sin(o * PI); \n        }\n\n        if (length < u_radius - bw / 1.1) {\n            d_opacity = 1.0 - angleT / PI * (PI / width);\n        } \n\n        if (length > u_radius) { d_opacity = 0.0; }\n \n        gl_FragColor = vec4(u_color, d_opacity * u_opacity);\n    }")};function bt(e){var t=e.radius,n=void 0===t?50:t,i=e.color,o=void 0===i?"#fff":i,r=e.speed,a=void 0===r?1:r,s=e.opacity,u=void 0===s?1:s,c=e.angle,l=void 0===c?Math.PI:c,d=e.position,f=void 0===d?{x:0,y:0,z:0}:d,p=e.rotation,m=void 0===p?{x:-Math.PI/2,y:0,z:0}:p,v=2*n,h=new oe.BKK(v,v,1,1),y=new oe.jyz({uniforms:{u_radius:{value:n},u_speed:{value:a},u_opacity:{value:u},u_width:{value:l},u_color:{value:new oe.Ilk(o)},time:{value:0}},transparent:!0,depthWrite:!1,side:oe.ehD,vertexShader:xt.vertexShader,fragmentShader:xt.fragmentShader}),g=new oe.Kj0(h,y);return g.rotation.set(m.x,m.y,m.z),g.position.copy(f),g}var Tt="\nuniform vec3 u_color;\n\nuniform float time;\nuniform float u_height;\n \nvarying float v_opacity;\n\nvoid main() {\n\n    vec3 vPosition = position * mod(time, 1.0);\n\n    v_opacity = mix(1.0, 0.0, position.y / u_height);\n \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n}\n",Mt=" \nuniform vec3 u_color;\nuniform float u_opacity;\n \nvarying float v_opacity;\n\nvoid main() { \n    gl_FragColor = vec4(u_color, v_opacity * u_opacity);\n}\n";function Et(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radius,n=e.height,i=e.opacity,o=e.color,r=e.speed,a=e.renderOrder,s=new oe.fHI(t,t,n,32,1,!0);s.translate(0,n/2,0);var u=new oe.jyz({uniforms:{u_height:{value:n},u_speed:{value:r||1},u_opacity:{value:i},u_color:{value:new oe.Ilk(o)},time:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1,side:oe.ehD,vertexShader:Tt,fragmentShader:Mt}),c=new oe.Kj0(s,u);return c.renderOrder=a||1,c}function St(e){var t=e.source,n=e.target,i=e.height,o=e.size,r=e.color,a=e.range,s=[],u=[],c=[],l=[],d=new oe.Pa4(t.x,t.y,t.z),f=new oe.Pa4(n.x,n.y,n.z),p=f.clone().lerp(d,.5);p.y+=i;var m=parseInt(d.distanceTo(p)+f.distanceTo(p)),v=new oe.mXe(d,p,f),h=v.getPoints(m);h.forEach((function(e,t){var n=t/(m-1);s.push({x:e.x,y:e.y,z:e.z}),c.push(n),l.push(t)})),s.forEach((function(e){u.push(e.x,e.y,e.z)}));var y=new oe.u9r;y.setAttribute("position",new oe.a$l(u,3)),y.setAttribute("index",new oe.a$l(c,1)),y.setAttribute("current",new oe.a$l(l,1));var g=new oe.jyz({transparent:!0,depthWrite:!1,depthTest:!1,blending:oe.WMw,uniforms:{uColor:{value:new oe.Ilk(r)},uRange:{value:a||100},uSize:{value:o},uTotal:{value:m},time:{value:0}},vertexShader:"\n        attribute float index;\n        attribute float current;\n        uniform float time;\n        uniform float uSize;\n        uniform float uRange; // 展示区间\n        uniform float uTotal; // 粒子总数\n        uniform vec3 uColor; \n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            // 需要当前显示的索引\n            float size = uSize;\n            float showNumber = uTotal * mod(time, 1.1);\n            if (showNumber > current && showNumber < current + uRange) {\n                float uIndex = ((current + uRange) - showNumber) / uRange;\n                size *= uIndex;\n                vOpacity = 1.0;\n            } else {\n                vOpacity = 0.0;\n            }\n\n            // 顶点着色器计算后的Position\n            vColor = uColor;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition; \n            // 大小\n            gl_PointSize = size * 300.0 / (-mvPosition.z);\n        }",fragmentShader:"\n        varying vec3 vColor; \n        varying float vOpacity;\n        void main() {\n            gl_FragColor = vec4(vColor, vOpacity);\n        }"}),w=new oe.woe(y,g);return w}var kt=[{position:{x:666,y:22,z:0},radius:150,color:"#ff0000",opacity:.5,speed:2},{position:{x:200,y:25,z:2466},radius:220,color:"#efad35",opacity:.5,speed:1}],Pt=[{position:{x:-150,y:15,z:100},speed:.5,color:"#efad35",opacity:.9,radius:5e3,height:220,renderOrder:5}],Ct=[{source:{x:-150,y:15,z:100},target:{x:200,y:25,z:2466},range:120,height:100,color:"#efad35",speed:1,size:30},{source:{x:-150,y:15,z:100},target:{x:666,y:22,z:0},height:300,range:150,color:"#ff0000",speed:1,size:40}],At=function(){function e(t,n){var i=this;(0,he.Z)(this,e),(0,et.Z)(this,"animate",(function(e){if(e>1)return!1;i.time.value+=e,i.isStart&&(i.StartTime.value+=.5*e,i.StartTime.value>=1&&(i.StartTime.value=1,i.isStart=!1))})),this.app=t,this.gltfLoader=new Ze.E,this.group=new oe.ZAu,this.effectMap={"对象001":{opacity:.6,uColor:"#4C8BF5",uActiveColor:"#fff"},"对象002":{opacity:1,uColor:"#4C8BF5",uActiveColor:"#fff"}},this.effectGroup=new oe.ZAu,this.group.add(this.effectGroup),this.surroundLineMaterial=null,this.time={value:0},this.StartTime={value:0},this.isStart=!1,this.loadScene(n)}return(0,ye.Z)(e,[{key:"loadeffect",value:function(){for(var e in this.effectMap){var t=this.effectMap[e],n=this.app.scene.getObjectByName(e);n&&(n.opacity=t.opacity,this.setCityMaterial(n),this.surroundLine(n,t))}this.init()}},{key:"loadScene",value:function(e){var t=this;this.loadGltf(window.baseSceneUrl).then((function(n){n.position.setY(108),n.name="pyScene",t.group.add(n);var i=t.group.getObjectByName("对象001");i.setPickEnabled(!1),i.setOpacity(.3),e&&e()}))}},{key:"loadGltf",value:function(e){var t=this;return new Promise((function(n,i){try{t.gltfLoader.load(e,(function(e){n(e.scene)}))}catch(o){i(o)}}))}},{key:"init",value:function(){var e=this;this.isStart=!0,kt.forEach((function(t){var n=bt(t);n.material.uniforms.time=e.time,e.effectGroup.add(n)})),Pt.forEach((function(t){var n=Et(t);n.material.uniforms.time=e.time,e.effectGroup.add(n)})),Ct.forEach((function(t){var n=St(t);n.material.uniforms.time=e.time,n.renderOrder=10,e.effectGroup.add(n)}))}},{key:"setCityMaterial",value:function(e){var t=this;e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere();var n=e.geometry,i=n.boundingSphere,o=i.center,r=i.radius,a=n.boundingBox,s=a.max,u=a.min,c=new oe.Pa4(s.x-u.x,s.y-u.y,s.z-u.z);gt.forMaterial(e.material,(function(e){e.opacity=.6,e.transparent=!0,e.color.setStyle("#1B3045"),e.onBeforeCompile=function(e){e.uniforms.time=t.time,e.uniforms.uStartTime=t.StartTime,e.uniforms.uCenter={value:o},e.uniforms.uSize={value:c},e.uniforms.uMax={value:s},e.uniforms.uMin={value:u},e.uniforms.uTopColor={value:new oe.Ilk("#FFFFDC")},e.uniforms.uSwitch={value:new oe.Pa4(0,0,0)},e.uniforms.uDiffusion={value:new oe.Pa4(1,120,600)},e.uniforms.uDiffusionCenter={value:new oe.Pa4(0,0,0)},e.uniforms.uFlow={value:new oe.Pa4(1,10,20)},e.uniforms.uColor={value:new oe.Ilk("#5588aa")},e.uniforms.uFlowColor={value:new oe.Ilk("#5588AA")},e.uniforms.uOpacity={value:1},e.uniforms.uRadius={value:r};var n="\n    float distanceTo(vec2 src, vec2 dst) {\n        float dx = src.x - dst.x;\n        float dy = src.y - dst.y;\n        float dv = dx * dx + dy * dy;\n        return sqrt(dv);\n    }\n\n    float lerp(float x, float y, float t) {\n        return (1.0 - t) * x + t * y;\n    }\n\n    vec3 getGradientColor(vec3 color1, vec3 color2, float index) {\n        float r = lerp(color1.r, color2.r, index);\n        float g = lerp(color1.g, color2.g, index);\n        float b = lerp(color1.b, color2.b, index);\n        return vec3(r, g, b);\n    }\n\n    varying vec4 vPositionMatrix;\n    varying vec3 vPosition;\n\n    uniform float time;\n    // 扩散参数\n    uniform float uRadius;\n    uniform float uOpacity;\n    // 初始动画参数\n    uniform float uStartTime; \n\n    uniform vec3 uMin;\n    uniform vec3 uMax;\n    uniform vec3 uSize;\n    uniform vec3 uFlow;\n    uniform vec3 uColor;\n    uniform vec3 uCenter;\n    uniform vec3 uSwitch;\n    uniform vec3 uTopColor;\n    uniform vec3 uFlowColor;\n    uniform vec3 uDiffusion; \n    uniform vec3 uDiffusionCenter;\n\n    void main() {\n        ",i="\n    vec3 distColor = outgoingLight;\n    float dstOpacity = diffuseColor.a;\n    \n    float indexMix = vPosition.z / (uSize.z * 0.6);\n    distColor = mix(distColor, uTopColor, indexMix);\n    \n    // 开启扩散波\n    vec2 position2D = vec2(vPosition.x, vPosition.y);\n    if (uDiffusion.x > 0.5) {\n        // 扩散速度\n        float dTime = mod(time * uDiffusion.z, uRadius * 2.0);\n        // 当前的离中心点距离\n        float uLen = distanceTo(position2D, vec2(uCenter.x, uCenter.z));\n\n        // 扩散范围\n        if (uLen < dTime && uLen > dTime - uDiffusion.y) {\n            // 颜色渐变\n            float dIndex = sin((dTime - uLen) / uDiffusion.y * PI);\n            distColor = mix(uColor, distColor, 1.0 - dIndex);\n        }\n    }\n\n    // 流动效果\n    if (uFlow.x > 0.5) {\n        // 扩散速度\n        float dTime = mod(time * uFlow.z, uSize.z); \n        // 流动范围\n        float topY = vPosition.z + uFlow.y;\n        if (dTime > vPosition.z && dTime < topY) {\n            // 颜色渐变 \n            float dIndex = sin((topY - dTime) / uFlow.y * PI);\n\n            distColor = mix(distColor, uFlowColor,  dIndex); \n        }\n    }\n  \n\n    gl_FragColor = vec4(distColor, dstOpacity * uStartTime);\n        ";e.fragmentShader=e.fragmentShader.replace("void main() {",n),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );",i);var a="\n    varying vec4 vPositionMatrix;\n    varying vec3 vPosition;\n    uniform float uStartTime;\n    void main() {\n            vPositionMatrix = projectionMatrix * vec4(position, 1.0);\n            vPosition = position;\n            ",l="\n    vec3 transformed = vec3(position.x, position.y, position.z * uStartTime);\n            ";e.vertexShader=e.vertexShader.replace("void main() {",a),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",l)}}))}},{key:"surroundLine",value:function(e,t){var n=t.opacity,i=void 0===n?.6:n,o=t.uColor,r=void 0===o?"#4C8BF5":o,a=t.uActiveColor,s=void 0===a?"#fff":a,u=mt.surroundLineGeometry(e),c=new oe.Pa4;e.getWorldPosition(c);var l=e.geometry.boundingBox,d=l.max,f=l.min,p=new oe.Pa4(d.x-f.x,d.y-f.y,d.z-f.z),m=this.createSurroundLineMaterial({max:d,min:f,size:p,opacity:i,uColor:r,uActiveColor:s}),v=new oe.ejS(u,m);v.name="surroundLine",v.scale.copy(e.scale),v.rotation.copy(e.rotation),v.position.copy(c),this.effectGroup.add(v)}},{key:"createSurroundLineMaterial",value:function(e){var t=e.max,n=e.min,i=(e.size,e.opacity),o=void 0===i?.6:i,r=e.uColor,a=void 0===r?"#4C8BF5":r,s=e.uActiveColor,u=void 0===s?"#fff":s;return this.surroundLineMaterial=new oe.jyz({transparent:!0,uniforms:{uColor:{value:new oe.Ilk(a)},uActive:{value:new oe.Ilk(u)},time:this.time,uOpacity:{value:o},uMax:{value:t},uMin:{value:n},uRange:{value:200},uSpeed:{value:.2},uStartTime:this.StartTime},vertexShader:yt.surroundLine.vertexShader,fragmentShader:yt.surroundLine.fragmentShader}),this.surroundLineMaterial}}]),e}(),_t=At,zt=n(3448),jt=n(8349),Ot=n(9726),It=(n(6699),n(2023),n(4197),n(8675),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),n(7272)),Lt=function(){function e(t){(0,he.Z)(this,e),this.app=t,this.controls=t.render.controls,this.camera=t.camera,this.current={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z,x1:this.controls.target.x,y1:this.controls.target.y,z1:this.controls.target.z},this.customizedObj={"对象002":{x:-439,y:451,z:4881,x1:0,y1:0,z1:0},default:{x:-3641,y:2199,z:-77,x1:0,y1:0,z1:0},tunnel:{x:-114,y:176,z:-920,x1:-46,y1:120,z1:-932}},this.tunnelArray=["对象011","对象012","对象013","对象014","对象015","对象016","对象017","对象018","对象019","对象020","对象021","对象022","对象023","对象024","对象025","对象026"]}return(0,ye.Z)(e,[{key:"getCustomizedPos",value:function(e){return this.tunnelArray.includes(e)&&(e="tunnel"),this.customizedObj[e]}},{key:"getResultData",value:function(e){var t={};if("object"===(0,Ot.Z)(e)){var n=e.getCenter&&e.getCenter(),i=n.x,o=n.y,r=n.z,a=e instanceof xe?[30,20,30]:[300,500,300];t=this.getCustomizedPos(e.name)||{x:i+a[0],y:o+a[1],z:r+a[2],x1:i,y1:o,z1:r}}else t=this.getCustomizedPos(e);return t}},{key:"flyTo",value:function(e,t){var n=this,i=this.getResultData(e);this.tween=new It.kX(this.current),this.tween.onComplete((function(){var e=new oe.Pa4(i.x1,i.y1,i.z1);t&&t(),n.controls.target=e})),this.tween.onUpdate((function(){META.fly.update()})),this.tween.to(i,1500),this.tween.start()}},{key:"update",value:function(){this.camera.position.set(this.current.x,this.current.y,this.current.z),this.camera.lookAt(this.current.x1,this.current.y1,this.current.z1)}},{key:"animate",value:function(e){this.tween&&this.tween.update(),this.mixer&&this.mixer.update(e)}},{key:"motion",value:function(){var e=new oe.DvJ(5,5,5),t=new oe.Kj0(e,new oe.YBo({color:255}));this.app.scene.add(t),t.position.set(-10,-50,-50);var n=new oe.YT8([new oe.Pa4(-10,-50,-50),new oe.Pa4(10,0,0),new oe.Pa4(8,50,50),new oe.Pa4(-5,0,100)]),i=n.getPoints(100);console.log("points",i);var o=new oe.u9r;o.vertices=i;var r=new oe.nls({color:4491519}),a=new oe.x12(o,r);this.app.scene.add(a);for(var s=[],u=0;u<101;u++)s.push(u);var c=new Float32Array(s),l=[];i.forEach((function(e){l.push(e.x,e.y,e.z)}));var d=new Float32Array(l),f=new oe.tUh(".position",c,d),p=101,m=new oe.m7l("default",p,[f]);this.mixer=new oe.Xcj(t);var v=this.mixer.clipAction(m);v.timeScale=20,v.play()}},{key:"changeLookAt",value:function(e){var t=curve.getPointAt(e);mesh.position.copy(t);var n=curve.getTangentAt(e),i=n.add(t);mesh.lookAt(i)}}]),e}(),Rt=Lt,Zt=function(){function e(){(0,he.Z)(this,e),this.scene=new oe.xsS,this.factory=at,this.camera=null,this.render=null,this.clock=new oe.SUY,this.CSS2DRenderer=new be.M,this.isLogin=0,this.dom=null,this.scId=null,this.productManager=new We,this.mixerObject={},this.isFlyControls=!1,this.isScreen=!1,this.onLoad=!1}return(0,ye.Z)(e,[{key:"init",value:function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.dom=t||document.getElementById("div3d"),this.initSceneAndCamera(),this.initRender(),this.creatCSS2DRenderer(),this.initControls(),this.tunnel=new _t(this,(function(){n.callFun(),n.animate(),n.updateOnWindowResize()})),this.scene.add(this.tunnel.group);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadScene",value:function(){var e=(0,ve.Z)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.productManager.loadModels();case 2:return e.next=4,this.productManager.loadMaterials();case 4:this.productManager.setParkObj(this.productManager.getModelByName("demo").scene),this.factory.getCis(10010,(function(){var e=t.scene.children.filter((function(e){return"Park"===e.type}))[0];e&&e.position.setY(208),t.callFun(),t.animate()}));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initSceneAndCamera",value:function(){this.camera=new oe.cPb(45,this.dom.clientWidth/this.dom.clientHeight,1,5e6),this.camera.position.set(6706.452849809113,3466.627800031605,3438.7962564494514),this.camera.lookAt(this.scene.position),this.scene.add(this.camera)}},{key:"callFun",value:function(){this.effect=new pt(this),this.eventInput=new Re(this),this.fly=new Rt(this),_e(this.dom.offsetWidth>1920),this.isScreen=(this.dom.offsetWidth,!1),this.onLoad=!0,this.fly.flyTo("default",(function(){Oe()}))}},{key:"initRender",value:function(){var e=document.createElement("canvas"),t=e.getContext("webgl2",{antialias:!0,alpha:!0});this.render=new oe.CP7({canvas:e,context:t}),this.render.gammaInput=!0,this.render.shadowMap.type=oe.ntZ,this.render.gammaOutput=!0,this.render.shadowMap.enabled=!0,this.render.setSize(this.dom.clientWidth,this.dom.clientHeight),this.composer=new st.xC(this.render);var n=new ut.C(this.scene,this.camera);this.composer.addPass(n),this.dom.appendChild(this.render.domElement)}},{key:"creatCSS2DRenderer",value:function(){this.CSS2DRenderer.setSize(this.dom.clientWidth,this.dom.clientHeight),this.CSS2DRenderer.domElement.style.position="absolute",this.CSS2DRenderer.domElement.style.top="0",this.dom.appendChild(this.CSS2DRenderer.domElement)}},{key:"createFlyControls",value:function(){this.flyControls=new jt.m(this.camera,this.render.domElement),this.flyControls.movementSpeed=35,this.flyControls.domElement=this.render.domElement,this.flyControls.rollSpeed=Math.PI/6,this.flyControls.autoForward=!1,this.flyControls.dragToLook=!1}},{key:"initControls",value:function(){var e=new zt.z(this.camera,this.CSS2DRenderer.domElement);e.target.set(0,.5,0),e.enableZoom=!0,e.enablePan=!0,e.maxDistance=2e4,this.render.controls=e}},{key:"renderer3dUpdate",value:function(){this.mixer&&this.mixer.update(this.clock.getDelta()),this.tunnel&&this.tunnel.animate(this.clock.getDelta()),this.fly.animate(this.clock.getDelta()),this.CSS2DRenderer.render(this.scene,this.camera),this.composer.render()}},{key:"setMixerObj",value:function(e,t){this.mixerObject[e]=t}},{key:"getMixerObj",value:function(e){return this.mixerObject[e]}},{key:"removeMixer",value:function(e){delete this.mixerObject[e]}},{key:"updateMixer",value:function(e){for(var t in this.mixerObject)this.mixerObject[t].update(e)}},{key:"animate",value:function(){window.META.renderer3dUpdate(),requestAnimationFrame(window.META.animate)}},{key:"updateOnWindowResize",value:function(){var e=this;window.addEventListener("resize",(function(){e.updateDomResize()}),!0)}},{key:"updateDomResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.dom.style.width=e+"px",this.dom.style.height=t+"px",this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.render.setSize(e,t)}}]),e}();window.META=new Zt,window.$=me(),window.META=window.META||{},window.META.isMock=!0,window.META.creeate=ot,i["default"].use(r()),i["default"].config.productionTip=!1,new i["default"]({router:ie,render:function(e){return e(d)}}).$mount("#app")},9242:function(e,t,n){e.exports=n.p+"static/img/bottom.472fb2ba.png"},5155:function(e,t,n){e.exports=n.p+"static/img/leftTop.6bcf09e5.png"},9691:function(e,t,n){e.exports=n.p+"static/img/rightTip.fd4737dd.png"},7027:function(e,t,n){e.exports=n.p+"static/img/top.abb29963.png"}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=e,function(){var e=[];n.O=function(t,i,o,r){if(!i){var a=1/0;for(l=0;l<e.length;l++){i=e[l][0],o=e[l][1],r=e[l][2];for(var s=!0,u=0;u<i.length;u++)(!1&r||a>=r)&&Object.keys(n.O).every((function(e){return n.O[e](i[u])}))?i.splice(u--,1):(s=!1,r<a&&(a=r));if(s){e.splice(l--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[i,o,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,i){return n.f[i](e,t),t}),[]))}}(),function(){n.u=function(e){return"static/js/about-legacy.0cc62066.js"}}(),function(){n.miniCssF=function(e){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="channel:";n.l=function(i,o,r,a){if(e[i])e[i].push(o);else{var s,u;if(void 0!==r)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==t+r){s=d;break}}s||(u=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+r),s.src=i),e[i]=[o];var f=function(t,n){s.onerror=s.onload=null,clearTimeout(p);var o=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(e){return e(n)})),t)return t(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){n.p=""}(),function(){var e={143:0};n.f.j=function(t,i){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)i.push(o[2]);else{var r=new Promise((function(n,i){o=e[t]=[n,i]}));i.push(o[2]=r);var a=n.p+n.u(t),s=new Error,u=function(i){if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,o[1](s)}};n.l(a,u,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,r,a=i[0],s=i[1],u=i[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(u)var l=u(n)}for(t&&t(i);c<a.length;c++)r=a[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(l)},i=self["webpackChunkchannel"]=self["webpackChunkchannel"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(7447)}));i=n.O(i)})();
//# sourceMappingURL=app-legacy.a2449803.js.map